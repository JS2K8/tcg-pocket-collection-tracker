import{u as V,W as Y,V as G,r as d,U as J,q as Q,H as M,b7 as X,bd as E,b8 as Z,j as e,D as $,v as A,x as ee,y as se,z as ae,A as O,B as te,ba as re,aB as W}from"./index-B0oFT0L9.js";import{u as le,s as ie,g as ne,F as me,a as F,b as C,d as S,c as T,S as de,e as oe}from"./SocialShareButtons-D6rbat2M.js";import{N as P}from"./RarityFilter-D34TbW69.js";import{M as h,C as _}from"./index-xQZjzrNW.js";import"./index-kwcpXll-.js";const g=["◊","◊◊","◊◊◊","◊◊◊◊","☆"],ue=({ownedCards:c,friendCards:u,ownAccount:m,friendAccount:l})=>{const{t:a}=V("trade-matches"),j=Y(),B=G(),{user:w,account:i,setAccount:H}=d.useContext(J),y=(m==null?void 0:m.friend_id)===(l==null?void 0:l.friend_id),[k,I]=d.useState(!1),[f,U]=d.useState(((m==null?void 0:m.max_number_of_cards_wanted)||1)-1),[b,K]=d.useState(((m==null?void 0:m.min_number_of_cards_to_keep)||1)+1);d.useEffect(()=>{j.pathname.includes("/collection")&&j.pathname.includes("/trade")?k||I(!0):I(!1)},[j]);const D=d.useMemo(()=>Q.filter(s=>s.tradeable).map(s=>s.id),[]),N=d.useMemo(()=>{const s={"◊":[],"◊◊":[],"◊◊◊":[],"◊◊◊◊":[],"☆":[],"☆☆":[],"☆☆☆":[],"✵":[],"✵✵":[],"Crown Rare":[],P:[],"":[]},r=u.filter(t=>t.amount_owned>((l==null?void 0:l.min_number_of_cards_to_keep)||1)),o=new Set(c.filter(t=>t.amount_owned>f).map(t=>t.card_id)),p=r.filter(t=>!o.has(t.card_id));for(const t of p){const n=M(t.card_id);n&&g.includes(n.rarity)&&D.includes(n.expansion)&&s[n.rarity].push({...n,amount_owned:t.amount_owned})}return s},[c,u,f,b]),v=d.useMemo(()=>{const s={"◊":[],"◊◊":[],"◊◊◊":[],"◊◊◊◊":[],"☆":[],"☆☆":[],"☆☆☆":[],"✵":[],"✵✵":[],"Crown Rare":[],P:[],"":[]},r=c.filter(t=>t.amount_owned>=b),o=new Set(u.filter(t=>t.amount_owned>=((l==null?void 0:l.max_number_of_cards_wanted)||1)).map(t=>t.card_id)),p=r.filter(t=>!o.has(t.card_id));for(const t of p){const n=M(t.card_id);n&&g.includes(n.rarity)&&D.includes(n.expansion)&&s[n.rarity].push({...n,amount_owned:t.amount_owned})}return s},[c,u,f,b]),R=d.useMemo(()=>g.some(s=>N[s].length>0&&v[s].length>0),[N,v]),L=X({is_active_trading:Z(),min_number_of_cards_to_keep:E.number().min(1).max(10),max_number_of_cards_wanted:E.number().min(1).max(10)}),x=le({resolver:ie(L),values:{is_active_trading:(i==null?void 0:i.is_active_trading)||!1,min_number_of_cards_to_keep:(i==null?void 0:i.min_number_of_cards_to_keep)||1,max_number_of_cards_wanted:(i==null?void 0:i.max_number_of_cards_wanted)||1}}),q=async s=>{try{const r=await re.from("accounts").upsert({email:w==null?void 0:w.user.email,username:i==null?void 0:i.username,is_active_trading:s.is_active_trading,min_number_of_cards_to_keep:s.min_number_of_cards_to_keep,max_number_of_cards_wanted:s.max_number_of_cards_wanted}).select().single();if(!r.data)throw console.error("Could not save account",i),new Error("Could not save account");H(r.data),W({title:a("accountSaved"),variant:"default"})}catch(r){console.error("error saving account",r),W({title:a("errorSavingAccount"),variant:"destructive"})}},z=()=>y?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-xl ",children:a("ownCollection")}),e.jsx("p",{className:"text-sm text-gray-300 mt-2",children:a("ownCollectionDescription")}),e.jsx(me,{...x,children:e.jsx("form",{onSubmit:x.handleSubmit(q),className:"mt-8 flex justify-center",children:e.jsxs("div",{className:"border-1 border-neutral-700 p-4 space-y-2",children:[e.jsx(F,{control:x.control,name:"is_active_trading",render:({field:s})=>e.jsx(C,{className:"flex flex-col items-start",children:e.jsx(S,{children:e.jsxs("div",{className:"flex items-center gap-x-4 flex-wrap",children:[e.jsx(T,{className:"flex sm:w-72",children:a("isActiveTrading")}),e.jsx("div",{className:"grow-1",children:e.jsx(de,{checked:s.value,onCheckedChange:s.onChange})}),e.jsx(oe,{className:"grow",children:s.value?"active":"disabled"}),e.jsx(h,{id:"activeInput",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(_,{className:"h-4 w-4","data-tooltip-id":"activeInput","data-tooltip-content":a("activeTradingInputTooltip")})]})})})}),e.jsx(F,{control:x.control,name:"min_number_of_cards_to_keep",render:({field:s})=>e.jsx(C,{className:"flex flex-col items-start",children:e.jsx(S,{children:e.jsxs("div",{className:"flex items-center gap-x-4 flex-wrap",children:[e.jsx(T,{className:"flex sm:w-72",children:a("minNumberOfCardsToKeep")}),e.jsx("div",{className:"grow-1",children:e.jsx(O,{type:"number",...s})}),e.jsx(h,{id:"minInput",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(_,{className:"h-4 w-4","data-tooltip-id":"minInput","data-tooltip-content":a("minInputTooltip")})]})})})}),e.jsx(F,{control:x.control,name:"max_number_of_cards_wanted",render:({field:s})=>e.jsx(C,{className:"flex flex-col items-start",children:e.jsx(S,{children:e.jsxs("div",{className:"flex items-center gap-x-4 flex-wrap",children:[e.jsx(T,{className:"flex sm:w-72",children:a("maxNumberOfCardsWanted")}),e.jsx("div",{className:"grow-1",children:e.jsx(O,{type:"number",...s})}),e.jsx(h,{id:"maxInput",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(_,{className:"h-4 w-4","data-tooltip-id":"maxInput","data-tooltip-content":a("maxInputTooltip")})]})})})}),e.jsx("div",{className:"w-full flex justify-end mt-8",children:e.jsx(te,{type:"submit",children:a("save")})})]})})})]}):l!=null&&l.is_active_trading?R?g.map(s=>N[s].length>0&&v[s].length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:s}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-medium mb-2",children:a("friendHas")}),e.jsx("div",{className:"border rounded p-2 max-h-60 overflow-y-auto",children:e.jsx("ul",{className:"space-y-1",children:N[s].map(r=>{var o;return e.jsxs("li",{className:"flex justify-between",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsxs("span",{className:"min-w-14 me-4",children:[r.card_id," "]}),e.jsx("span",{children:r.name})]}),e.jsx("span",{title:a("amountYouOwn"),className:"text-gray-500",children:e.jsxs("span",{style:{userSelect:"none"},children:["×",((o=c.find(p=>p.card_id===r.card_id))==null?void 0:o.amount_owned)||0]})})]},r.card_id)})})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-medium mb-2",children:a("youHave")}),e.jsx("div",{className:"border rounded p-2 max-h-60 overflow-y-auto",children:e.jsx("ul",{className:"space-y-1",children:v[s].map(r=>e.jsxs("li",{className:"flex justify-between",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsxs("span",{className:"min-w-14 me-4",children:[r.card_id," "]}),e.jsx("span",{children:r.name})]}),e.jsx("span",{title:a("amountFriendOwns"),className:"text-gray-500",children:e.jsxs("span",{style:{userSelect:"none"},children:["×",r.amount_owned]})})]},r.card_id))})})]})]})]},s)):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-xl ",children:a("noPossibleTrades")}),e.jsx("p",{className:"text-sm text-gray-300 mt-2",children:a("noPossibleTradesDescription")})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-xl ",children:a("inActiveTradePage",{username:l==null?void 0:l.username})}),e.jsx("p",{className:"text-sm text-gray-300 mt-2",children:a("inActiveTradeDescription")})]});return e.jsx($,{open:k,onOpenChange:s=>{s||B(j.pathname.replace("/trade",""))},children:e.jsxs(A,{className:"border-1 border-neutral-700 shadow-none max-w-4xl h-[90vh] content-start flex flex-col",children:[e.jsx(ee,{children:e.jsx(se,{children:a("title")})}),e.jsxs("div",{className:"flex flex-col gap-4 grow",children:[e.jsx("p",{className:"pb-2",children:a("featureDescription")}),e.jsx("p",{className:"pb-2",children:a("friendAccountDetails",{...l})}),!y&&e.jsxs("div",{className:"flex flex-row gap-4 mb-4 justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{numberFilter:f,setNumberFilter:U,options:[0,1,2,3,4,5],labelKey:"maxNum"}),e.jsx(h,{id:"minFilter",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(_,{className:"h-4 w-4","data-tooltip-id":"minFilter","data-tooltip-content":a("minFilterTooltip")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{id:"maxFilter",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(_,{className:"h-4 w-4","data-tooltip-id":"maxFilter","data-tooltip-content":a("maxFilterTooltip")}),e.jsx(P,{numberFilter:b,setNumberFilter:K,options:[2,3,4,5],labelKey:"minNum"})]})]}),z()]}),y&&e.jsx(ae,{children:e.jsx(ne,{})})]})})};export{ue as default};
