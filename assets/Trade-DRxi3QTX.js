import{u as x,j as e,K as W,r as t,U as X,C as Y,k as Z,v as k,au as R,av as ee,B as v,aw as re}from"./index-CRCNQJHB.js";import{T as ae,a as se,b as F,d as $,C as I,c as ne}from"./CardDetail-BBoDLt3i.js";import{R as te,N as M}from"./RarityFilter-2bdiphjj.js";import{A as b,a as C,b as j}from"./alert-DvwetFAM.js";import{S as h}from"./siren-CClNLaue.js";import"./Card-CH3UNa1T.js";function oe(){const{t:n}=x("pages/trade");return e.jsx("article",{className:"mx-auto grid max-w-4xl gap-5",children:e.jsxs(b,{className:"mb-8 border-1 border-neutral-700 shadow-none",children:[e.jsx(h,{className:"h-4 w-4"}),e.jsx(C,{children:n("noCardsNeeded.title")}),e.jsx(j,{children:n("noCardsNeeded.description")})]})})}function ie(){const{t:n}=x("pages/trade");return e.jsx("article",{className:"mx-auto grid max-w-4xl gap-5",children:e.jsxs(b,{className:"mb-8 border-1 border-neutral-700 shadow-none",children:[e.jsx(h,{className:"h-4 w-4"}),e.jsx(C,{children:n("noSellableCards.title")}),e.jsx(j,{children:n("noSellableCards.description")})]})})}function le(){const{t:n}=x("pages/trade");return e.jsx("article",{className:"mx-auto grid max-w-4xl gap-5",children:e.jsxs(b,{className:"mb-8 border-1 border-neutral-700 shadow-none",children:[e.jsx(h,{className:"h-4 w-4"}),e.jsx(C,{children:n("noTradeableCards.title")}),e.jsx(j,{children:n("noTradeableCards.description")})]})})}function de(){const{t:n}=x("pages/trade");return e.jsx("article",{className:"mx-auto grid max-w-4xl gap-5",children:e.jsxs(b,{className:"mb-8 border-1 border-neutral-700 shadow-none",children:[e.jsx(h,{className:"h-4 w-4"}),e.jsx(C,{children:n("notLoggedIn.title")}),e.jsx(j,{children:n("notLoggedIn.description")})]})})}function ge(){const{t:n}=x("pages/trade"),P=W(),{user:V,account:l,setIsProfileDialogOpen:A}=t.use(X),{ownedCards:i,selectedCardId:S,setSelectedCardId:K}=t.use(Y),[c,O]=t.useState([]),[_,B]=t.useState(0),[y,U]=t.useState(2),[T,q]=t.useState(3),[m,z]=t.useState("looking_for"),E=t.useMemo(()=>Z.filter(r=>r.tradeable).map(r=>r.id),[]),N=r=>c.length===0?!0:r.rarity!==""&&c.includes(r.rarity),p=t.useMemo(()=>k.filter(r=>i.findIndex(a=>a.card_id===r.card_id)===-1||i[i.findIndex(a=>a.card_id===r.card_id)].amount_owned<=_).filter(r=>R[r.rarity]!==null&&E.includes(r.expansion)),[i,_]),w=t.useMemo(()=>p.filter(N),[p,c]),f=t.useMemo(()=>{const r=i.filter(a=>a.amount_owned>=y);return k.filter(a=>r.findIndex(o=>o.card_id===a.card_id)>-1).map(a=>({...a,amount_owned:r.find(o=>o.card_id===a.card_id)?.amount_owned})).filter(a=>R[a.rarity]!==null&&E.includes(a.expansion))},[i,y]),D=t.useMemo(()=>f.filter(N),[f,c]),g=t.useMemo(()=>{const r=i.filter(a=>a.amount_owned>=T);return k.filter(a=>r.findIndex(o=>o.card_id===a.card_id)>-1).map(a=>({...a,amount_owned:r.find(o=>o.card_id===a.card_id)?.amount_owned})).filter(a=>ee[a.rarity]!==null)},[i,T]),G=t.useMemo(()=>g.filter(N),[g,c]),H=()=>{let r="";l?.is_public&&(r+=`${n("publicTradePage")} https://tcgpocketcollectiontracker.com/#/collection/${l?.friend_id}/trade
`),l?.username&&(r+=`${n("friendID")} ${l.friend_id} (${l.username})

`),r+=`${n("lookingForCards")}
`;const a=w.sort((s,u)=>{const L=s.expansion.localeCompare(u.expansion);return L!==0?L:s.rarity.localeCompare(u.rarity)});for(let s=0;s<a.length;s++)(s>0?a[s-1].expansion:"")!==a[s].expansion&&(r+=`
${a[s].set_details}:
`),r+=`${a[s].rarity} ${a[s].card_id} - ${a[s].name}
`;const o=w.map(s=>s.rarity);r+=`

${n("forTradeCards")}
`;const d=D.filter(s=>o.includes(s.rarity)).sort((s,u)=>s.rarity.localeCompare(u.rarity));for(let s=0;s<d.length;s++)(s>0?d[s-1].expansion:"")!==d[s].expansion&&(r+=`
${d[s].set_details}:
`),r+=`${d[s].rarity} ${d[s].card_id} - ${d[s].name}
`;return r},J=async()=>{const r=H();re({title:n("copiedInClipboard"),variant:"default",duration:3e3}),await navigator.clipboard.writeText(r)},Q=()=>{A(!0)};return V?e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsxs(ae,{defaultValue:m,onValueChange:r=>z(r),children:[e.jsxs("div",{className:"mx-auto max-w-[900px] flex flex-row flex-wrap align-center gap-x-4 gap-y-2 px-4",children:[e.jsxs(se,{className:"flex-grow m-auto flex-wrap h-auto border-1 border-neutral-700 rounded-md",children:[e.jsx(F,{value:"looking_for",children:n("lookingFor")}),e.jsx(F,{value:"for_trade",children:n("forTrade")}),e.jsx(F,{value:"buying_tokens",children:n("buyingTokens")})]}),e.jsx(te,{rarityFilter:c,setRarityFilter:O}),e.jsxs("div",{className:"sm:mt-1 flex flex-row flex-wrap align-center gap-x-4 gap-y-1",children:[m==="looking_for"&&e.jsx(M,{numberFilter:_,setNumberFilter:B,options:[0,1,2,3,4,5],labelKey:"maxNum"}),m==="for_trade"&&e.jsx(M,{numberFilter:y,setNumberFilter:U,options:[2,3,4,5],labelKey:"minNum"}),m==="buying_tokens"&&e.jsx(M,{numberFilter:T,setNumberFilter:q,options:[2,3,4,5],labelKey:"minNum"}),e.jsx(v,{variant:"outline",onClick:()=>J(),children:"Copy to clipboard"}),l?.is_public?e.jsx(v,{variant:"outline",onClick:()=>P(`/collection/${l?.friend_id}/trade`),children:n("openTradingPage")}):e.jsx(v,{variant:"outline",onClick:()=>Q(),children:n("enableTradingPage")})]})]}),e.jsxs("div",{className:"mx-auto max-w-[900px] ",children:[e.jsx($,{value:"looking_for",children:p&&p.length>0?e.jsx(I,{cards:w,extraOffset:105}):e.jsx(oe,{})}),e.jsx($,{value:"for_trade",children:f&&f.length>0?e.jsx(I,{cards:D,extraOffset:105}):e.jsx(le,{})}),e.jsx($,{value:"buying_tokens",children:g&&g.length>0?e.jsx(I,{cards:G,extraOffset:105}):e.jsx(ie,{})})]})]}),S&&e.jsx(ne,{cardId:S,onClose:()=>K("")})]}):e.jsx(de,{})}export{ge as default};
