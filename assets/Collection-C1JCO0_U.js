import{e as F,j as e,I as k,S as E,f as A,h as I,i as V,r as n,U as L,C as S,k as O,D as _,l as v,m as P,B as M,M as z}from"./index-syj9j5EV.js";import{T as R,a as T,b}from"./tabs-DOJluF1S.js";import{e as $,b as G,u as H,c as B}from"./CardsDB-DoSXCLqW.js";import{R as U}from"./RarityFilter-C2Cv-RQ8.js";import{F as D,c as W,u as q,a as X,g as Y,b as J}from"./index-61RK3Kxb.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Q=F("Plus",K),Z=({expansionFilter:r,setExpansionFilter:i})=>e.jsx(R,{value:r,onValueChange:s=>i(s),className:"w-full",children:e.jsxs(T,{className:"w-full flex-wrap h-auto lg:h-[40px] border-2 border-slate-600 rounded-md",children:[e.jsx(b,{value:"all",children:"All"}),$.map(s=>e.jsx(b,{value:s.id,children:s.name},`tab_trigger_${s.id}`))]})}),ee=({ownedFilter:r,setOwnedFilter:i})=>e.jsx(R,{value:r,onValueChange:s=>i(s),className:"w-50",children:e.jsxs(T,{className:"w-full flex-wrap h-auto lg:h-10 bg-neutral-50 border-2 border-slate-600 rounded-md",children:[e.jsx(b,{value:"all",children:"All"}),e.jsx(b,{value:"missing",children:"Missing"}),e.jsx(b,{value:"owned",children:"Owned"})]})});let N=null;const se=({setSearchValue:r})=>e.jsx(k,{type:"search",placeholder:"Search...",className:"w-full md:w-64 border-2 h-[38px]",style:{borderColor:"#45556C"},onChange:i=>{N&&window.clearTimeout(N),N=window.setTimeout(()=>{r(i.target.value)},500)}});function te({cardId:r,onClose:i}){var o,x,u,d,c;const s=G(r||"")||{};return e.jsx(E,{open:!!r,onOpenChange:h=>{h||i()},children:e.jsxs(A,{className:"transition-all duration-300 ease-in-out border-slate-600 overflow-y-auto",children:[e.jsx(I,{children:e.jsxs(V,{children:[s.name," ",s.rarity]})}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"px-10 py-4",children:e.jsx(D,{card:s,selected:!0})}),e.jsxs("div",{className:"p-4 w-full",children:[e.jsxs("p",{className:"text-lg mb-1",children:[e.jsx("strong",{children:"HP:"})," ",s.hp]}),e.jsxs("p",{className:"text-lg mb-1",children:[e.jsx("strong",{children:"Card Type:"})," ",s.card_type]}),e.jsxs("p",{className:"text-lg mb-1",children:[e.jsx("strong",{children:"Evolution Type:"})," ",s.evolution_type]}),e.jsxs("p",{className:"text-lg mb-1",children:[e.jsx("strong",{children:"EX:"})," ",s.ex]}),e.jsxs("p",{className:"text-lg mb-1",children:[e.jsx("strong",{children:"Crafting Cost:"})," ",s.crafting_cost]}),e.jsxs("p",{className:"text-lg mb-1",children:[e.jsx("strong",{children:"Artist:"})," ",s.artist]}),e.jsxs("p",{className:"text-lg mb-1",children:[e.jsx("strong",{children:"Set Details:"})," ",s.set_details]}),e.jsxs("p",{className:"text-lg mb-1",children:[e.jsx("strong",{children:"Expansion:"})," ",s.expansion]}),e.jsxs("p",{className:"text-lg mb-1",children:[e.jsx("strong",{children:"Pack:"})," ",s.pack]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Details"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Weakness:"})," ",s.weakness||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Retreat:"})," ",s.retreat||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Ability:"})," ",((o=s.ability)==null?void 0:o.name)||"No ability"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Ability Effect:"})," ",((x=s.ability)==null?void 0:x.effect)||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Probability (1-3 cards):"})," ",((u=s.probability)==null?void 0:u["1-3 card"])||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Probability (4 cards):"})," ",((d=s.probability)==null?void 0:d["4 card"])||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Probability (5 cards):"})," ",((c=s.probability)==null?void 0:c["5 card"])||"N/A"]})]})]})]})]})})}const C={};function ae({card:r,onClick:i}){const{user:s,setIsLoginDialogOpen:o}=n.use(L),{ownedCards:x,setOwnedCards:u}=n.use(S);let d=n.useMemo(()=>{var t;return((t=x.find(l=>l.card_id===r.card_id))==null?void 0:t.amount_owned)||0},[x]);const[c,h]=n.useState(0);n.useEffect(()=>{h(d)},[d]);const p=n.useCallback(async(t,l)=>{d=Math.max(0,l),h(d),C[t]&&window.clearTimeout(C[t]),C[t]=window.setTimeout(async()=>{const j=await O(),m=x.find(w=>w.card_id===t);if(m)console.log("updating",m),m.amount_owned=Math.max(0,l),u([...x]),await j.updateDocument(_,v,m.$id,{amount_owned:m.amount_owned});else if(!m&&l>0){console.log("adding new card",t);const w=await j.createDocument(_,v,P.unique(),{email:s==null?void 0:s.email,card_id:t,amount_owned:l});u([...x,{$id:w.$id,email:w.email,card_id:w.card_id,amount_owned:w.amount_owned}])}},1e3)},[x,s,u,d]),g=n.useCallback(async t=>{if(!s){o(!0);return}await p(t,d+1)},[p]),f=n.useCallback(async t=>{if(!s){o(!0);return}await p(t,d-1)},[p]),a=async t=>{const l=t.target.value===""?0:Number.parseInt(t.target.value,10);!Number.isNaN(l)&&l>=0&&await p(r.card_id,l)};return e.jsxs("div",{className:"group flex w-fit max-w-32 md:max-w-40 flex-col items-center rounded-lg cursor-pointer",onClick:i,children:[e.jsx(D,{card:r,selected:d>0}),e.jsxs("p",{className:"max-w-[130px] overflow-hidden text-ellipsis whitespace-nowrap font-semibold text-[12px] pt-2",children:[r.card_id," - ",r.name]}),e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsx(M,{variant:"ghost",size:"icon",onClick:()=>f(r.card_id),className:"rounded-full",children:e.jsx(z,{})}),e.jsx("input",{min:"0",max:"99",type:"text",value:c,onChange:a,className:"w-7 text-center border-none rounded",onFocus:t=>t.target.select()}),e.jsx(M,{variant:"ghost",size:"icon",className:"rounded-full",onClick:()=>g(r.card_id),children:e.jsx(Q,{})})]})]})}const y=W();function le({cards:r,onCardClick:i}){const s=n.useRef(null),{width:o}=H(),x=n.useMemo(()=>[y.accessor("image",{id:"imageUrl"}),y.accessor("card_id",{id:"card_id"}),y.accessor("name",{id:"name"}),y.accessor("set_details",{id:"set_details"})],[]),u=q({columns:x,data:r,enableGrouping:!0,getCoreRowModel:J(),getGroupedRowModel:Y(),initialState:{grouping:["set_details"]}}),d=n.useMemo(()=>u.getGroupedRowModel().rows,[u.getGroupedRowModel().rows]);let c=5,h=Math.min(o,890)/5+120;o>600&&o<800?(c=4,h=o/3+50):o<=600&&(c=3,h=o/3+100);const p=n.useMemo(()=>d.map(a=>{const t={type:"header",row:a},l=a.subRows.map(m=>({type:"data",row:m})),j=[];for(let m=0;m<l.length;m+=c)j.push(l.slice(m,m+c));return{header:t,gridRows:j}}),[d,c]),g=n.useMemo(()=>p.flatMap(a=>[{type:"header",height:60,data:a.header},...a.gridRows.map(t=>({type:"gridRow",height:h,data:t}))]),[p]),f=X({getScrollElement:()=>s.current,count:g.length,estimateSize:a=>(g[a].type==="header"?60:h)+12,overscan:5});return e.jsx("div",{ref:s,className:"h-[calc(100vh-270px)] overflow-y-auto mt-4 sm:mt-8 px-4",style:{scrollbarWidth:"none"},children:e.jsx("div",{style:{height:`${f.getTotalSize()}px`},className:"relative w-full",children:f.getVirtualItems().map(a=>{const t=g[a.index];return e.jsx("div",{style:{height:`${a.size}px`,transform:`translateY(${a.start}px)`},className:"absolute top-0 left-0 w-full",children:t.type==="header"?e.jsx("h2",{className:"mx-auto mt-10 text-center w-full max-w-[900px] scroll-m-20 border-b-2 border-slate-600 pb-2 font-semibold text-md sm:text-lg md:text-2xl tracking-tight transition-colors first:mt-0",children:t.data.row.getValue("set_details")}):e.jsx("div",{className:"flex justify-center gap-x-3",children:t.data.map(({row:l})=>e.jsx(ae,{card:l.original,onClick:()=>i==null?void 0:i(l.original.card_id)},l.original.card_id))})},a.key)})})})}function ce(){const{ownedCards:r}=n.use(S),[i,s]=n.useState(""),[o,x]=n.useState("all"),[u,d]=n.useState([]),[c,h]=n.useState("all"),[p,g]=n.useState(null),f=n.useMemo(()=>{let a=B;return o!=="all"&&(a=a.filter(t=>t.expansion===o)),c!=="all"&&(c==="owned"?a=a.filter(t=>r.find(l=>l.card_id===t.card_id&&l.amount_owned>0)):c==="missing"&&(a=a.filter(t=>!r.find(l=>l.card_id===t.card_id&&l.amount_owned>0)))),u.length>0&&(a=a.filter(t=>u.includes(t.rarity))),i&&(a=a.filter(t=>t.name.toLowerCase().includes(i.toLowerCase())||t.card_id.toLowerCase().includes(i.toLowerCase()))),a},[o,u,i,c,r]);return e.jsxs("div",{className:"flex flex-col gap-y-1 mx-auto max-w-[900px]",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-col md:flex-row px-8",children:[e.jsx(se,{setSearchValue:s}),e.jsx(Z,{expansionFilter:o,setExpansionFilter:x})]}),e.jsxs("div",{className:"items-center justify-between gap-2 flex-col md:flex-row px-8 hidden md:flex",children:[e.jsx(ee,{ownedFilter:c,setOwnedFilter:h}),e.jsx(U,{rarityFilter:u,setRarityFilter:d})]}),e.jsxs("div",{children:[e.jsx(le,{cards:f,onCardClick:a=>g(a)}),e.jsx(te,{cardId:p,onClose:()=>g(null)})]})]})}export{ce as default};
