import{u,j as e,T as W,r as i,U as X,C as Y,o as Z,A as k,ay as D,az as ee,B as F,aA as re}from"./index-Dxn5a_pl.js";import{C as v,a as ae}from"./CardDetail-BUmmB_Vo.js";import{T as se,a as ne,b as $,R as te,N as I,c as M}from"./RarityFilter-PBQgu985.js";import{A as b,a as C,b as j}from"./alert-DkQGxn2Z.js";import{S as h}from"./index-BuWgRTWL.js";import"./Card-BU1E1ibI.js";function ie(){const{t:n}=u("pages/trade");return e.jsx("article",{className:"mx-auto grid max-w-4xl gap-5",children:e.jsxs(b,{className:"mb-8 border-1 border-neutral-700 shadow-none",children:[e.jsx(h,{className:"h-4 w-4"}),e.jsx(C,{children:n("noCardsNeeded.title")}),e.jsx(j,{children:n("noCardsNeeded.description")})]})})}function oe(){const{t:n}=u("pages/trade");return e.jsx("article",{className:"mx-auto grid max-w-4xl gap-5",children:e.jsxs(b,{className:"mb-8 border-1 border-neutral-700 shadow-none",children:[e.jsx(h,{className:"h-4 w-4"}),e.jsx(C,{children:n("noSellableCards.title")}),e.jsx(j,{children:n("noSellableCards.description")})]})})}function le(){const{t:n}=u("pages/trade");return e.jsx("article",{className:"mx-auto grid max-w-4xl gap-5",children:e.jsxs(b,{className:"mb-8 border-1 border-neutral-700 shadow-none",children:[e.jsx(h,{className:"h-4 w-4"}),e.jsx(C,{children:n("noTradeableCards.title")}),e.jsx(j,{children:n("noTradeableCards.description")})]})})}function de(){const{t:n}=u("pages/trade");return e.jsx("article",{className:"mx-auto grid max-w-4xl gap-5",children:e.jsxs(b,{className:"mb-8 border-1 border-neutral-700 shadow-none",children:[e.jsx(h,{className:"h-4 w-4"}),e.jsx(C,{children:n("notLoggedIn.title")}),e.jsx(j,{children:n("notLoggedIn.description")})]})})}function ge(){const{t:n}=u("pages/trade"),L=W(),{user:R,account:t,setIsProfileDialogOpen:P}=i.use(X),{ownedCards:d,selectedCardId:V,setSelectedCardId:B}=i.use(Y),[c,K]=i.useState([]),[y,U]=i.useState(0),[_,z]=i.useState(2),[T,O]=i.useState(3),[m,q]=i.useState("looking_for"),S=i.useMemo(()=>Z.filter(r=>r.tradeable).map(r=>r.id),[]),N=r=>c.length===0?!0:r.rarity!==""&&c.includes(r.rarity),p=i.useMemo(()=>k.filter(r=>d.findIndex(a=>a.card_id===r.card_id)===-1||d[d.findIndex(a=>a.card_id===r.card_id)].amount_owned<=y).filter(r=>D[r.rarity]!==null&&S.includes(r.expansion)),[d,y]),w=i.useMemo(()=>p.filter(N),[p,c]),f=i.useMemo(()=>{const r=d.filter(a=>a.amount_owned>=_);return k.filter(a=>r.findIndex(o=>o.card_id===a.card_id)>-1).map(a=>{var o;return{...a,amount_owned:(o=r.find(l=>l.card_id===a.card_id))==null?void 0:o.amount_owned}}).filter(a=>D[a.rarity]!==null&&S.includes(a.expansion))},[d,_]),E=i.useMemo(()=>f.filter(N),[f,c]),g=i.useMemo(()=>{const r=d.filter(a=>a.amount_owned>=T);return k.filter(a=>r.findIndex(o=>o.card_id===a.card_id)>-1).map(a=>{var o;return{...a,amount_owned:(o=r.find(l=>l.card_id===a.card_id))==null?void 0:o.amount_owned}}).filter(a=>ee[a.rarity]!==null)},[d,T]),G=i.useMemo(()=>g.filter(N),[g,c]),H=()=>{let r="";t!=null&&t.is_public&&(r+=`${n("publicTradePage")} https://tcgpocketcollectiontracker.com/#/collection/${t==null?void 0:t.friend_id}/trade
`),t!=null&&t.username&&(r+=`${n("friendID")} ${t.friend_id} (${t.username})

`),r+=`${n("lookingForCards")}
`;const a=w.sort((s,x)=>{const A=s.expansion.localeCompare(x.expansion);return A!==0?A:s.rarity.localeCompare(x.rarity)});for(let s=0;s<a.length;s++)(s>0?a[s-1].expansion:"")!==a[s].expansion&&(r+=`
${a[s].set_details}:
`),r+=`${a[s].rarity} ${a[s].card_id} - ${a[s].name}
`;const o=w.map(s=>s.rarity);r+=`

${n("forTradeCards")}
`;const l=E.filter(s=>o.includes(s.rarity)).sort((s,x)=>s.rarity.localeCompare(x.rarity));for(let s=0;s<l.length;s++)(s>0?l[s-1].expansion:"")!==l[s].expansion&&(r+=`
${l[s].set_details}:
`),r+=`${l[s].rarity} ${l[s].card_id} - ${l[s].name}
`;return r},J=async()=>{const r=H();re({title:n("copiedInClipboard"),variant:"default",duration:3e3}),await navigator.clipboard.writeText(r)},Q=()=>{P(!0)};return R?e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsxs(se,{defaultValue:m,onValueChange:r=>q(r),children:[e.jsxs("div",{className:"mx-auto max-w-[900px] flex flex-row flex-wrap align-center gap-x-4 gap-y-2 px-4",children:[e.jsxs(ne,{className:"flex-grow m-auto flex-wrap h-auto border-1 border-neutral-700 rounded-md",children:[e.jsx($,{value:"looking_for",children:n("lookingFor")}),e.jsx($,{value:"for_trade",children:n("forTrade")}),e.jsx($,{value:"buying_tokens",children:n("buyingTokens")})]}),e.jsx(te,{rarityFilter:c,setRarityFilter:K}),e.jsxs("div",{className:"sm:mt-1 flex flex-row flex-wrap align-center gap-x-4 gap-y-1",children:[m==="looking_for"&&e.jsx(I,{numberFilter:y,setNumberFilter:U,options:[0,1,2,3,4,5],labelKey:"maxNum"}),m==="for_trade"&&e.jsx(I,{numberFilter:_,setNumberFilter:z,options:[2,3,4,5],labelKey:"minNum"}),m==="buying_tokens"&&e.jsx(I,{numberFilter:T,setNumberFilter:O,options:[2,3,4,5],labelKey:"minNum"}),e.jsx(F,{variant:"outline",onClick:()=>J(),children:"Copy to clipboard"}),t!=null&&t.is_public?e.jsx(F,{variant:"outline",onClick:()=>L(`/collection/${t==null?void 0:t.friend_id}/trade`),children:n("openTradingPage")}):e.jsx(F,{variant:"outline",onClick:()=>Q(),children:n("enableTradingPage")})]})]}),e.jsxs("div",{className:"mx-auto max-w-[900px] ",children:[e.jsx(M,{value:"looking_for",children:p&&p.length>0?e.jsx(v,{cards:w}):e.jsx(ie,{})}),e.jsx(M,{value:"for_trade",children:f&&f.length>0?e.jsx(v,{cards:E}):e.jsx(le,{})}),e.jsx(M,{value:"buying_tokens",children:g&&g.length>0?e.jsx(v,{cards:G}):e.jsx(oe,{})})]})]}),e.jsx(ae,{cardId:V,onClose:()=>B("")})]}):e.jsx(de,{})}export{ge as default};
