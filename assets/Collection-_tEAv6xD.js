import{r as n,U as y,C as N,e as M,D as w,f as b,I as R,j as e}from"./index-Bj_KymPT.js";import{F as S,c as T,u as E,a as $,g as k,b as D,T as I,d as P,e as _,f as j}from"./FancyCard-CrkwCu9N.js";import{e as v,b as z}from"./CardsDB-CePrsvJ-.js";function G({card:l}){const{user:t}=n.use(y),{ownedCards:i,setOwnedCards:m}=n.use(N),h=n.useMemo(()=>{var o;return((o=i.find(d=>d.card_id===l.card_id))==null?void 0:o.amount_owned)||0},[i]),c=n.useCallback(async(o,d)=>{console.log(`${o} button clicked`);const a=await M(),s=i.find(r=>r.card_id===o);if(s)console.log("updating",s),s.amount_owned=Math.max(0,s.amount_owned+d),m([...i]),await a.updateDocument(w,b,s.$id,{amount_owned:s.amount_owned});else if(!s&&d>0){console.log("adding new card",o);const r=await a.createDocument(w,b,R.unique(),{email:t==null?void 0:t.email,card_id:o,amount_owned:d});m([...i,{$id:r.$id,email:r.email,card_id:r.card_id,amount_owned:r.amount_owned}])}},[i,t,m]),g=n.useCallback(async o=>{await c(o,1)},[c]),f=n.useCallback(async o=>{await c(o,-1)},[c]);return e.jsxs("div",{className:"group flex w-fit flex-col items-center gap-y-2 rounded-lg border border-gray-700 p-4 shadow-md transition duration-200 hover:shadow-lg",children:[e.jsx(S,{card:l,selected:h>0,setIsSelected:()=>{}}),e.jsxs("p",{className:"max-w-[130px] overflow-hidden text-ellipsis whitespace-nowrap font-semibold text-[12px]",children:[l.card_id," - ",l.name]}),e.jsxs("div",{className:"flex items-center gap-x-4",children:[e.jsx("button",{name:"remove","aria-label":"remove 1 card",type:"button",onClick:()=>f(l.card_id),className:"flex h-8 w-8 items-center justify-center rounded-full bg-red-500 text-white transition duration-200 hover:bg-red-400 focus:outline-none",children:e.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{d:"M5 10a.75.75 0 0 1 .75-.75h8.5a.75.75 0 0 1 0 1.5h-8.5A.75.75 0 0 1 5 10z"})})}),e.jsx("span",{className:"font-semibold text-lg",children:h}),e.jsx("button",{name:"add","aria-label":"add 1 card",type:"button",onClick:()=>g(l.card_id),className:"flex h-8 w-8 items-center justify-center rounded-full bg-green-500 text-white transition duration-200 hover:bg-green-400 focus:outline-none",children:e.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{d:"M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z"})})})]})]})}const x=T();function C({cards:l}){const t=n.useRef(null),[i,m]=n.useState(()=>{const a=localStorage.getItem("scrollPosition");return a?Number.parseInt(a,10):0}),h=n.useMemo(()=>[x.accessor("image",{id:"imageUrl"}),x.accessor("card_id",{id:"card_id"}),x.accessor("name",{id:"name"}),x.accessor("set_details",{id:"set_details"})],[]),c=E({columns:h,data:l,enableGrouping:!0,getCoreRowModel:D(),getGroupedRowModel:k(),initialState:{grouping:["set_details"]}}),g=n.useMemo(()=>c.getGroupedRowModel().rows,[c.getGroupedRowModel().rows]),f=n.useMemo(()=>g.map(a=>{const s={type:"header",row:a},r=a.subRows.map(u=>({type:"data",row:u})),p=[];for(let u=0;u<r.length;u+=5)p.push(r.slice(u,u+5));return{header:s,gridRows:p}}),[g]),o=n.useMemo(()=>f.flatMap(a=>[{type:"header",height:45,data:a.header},...a.gridRows.map(s=>({type:"gridRow",height:269,data:s}))]),[f]),d=$({getScrollElement:()=>t.current,count:o.length,estimateSize:a=>(o[a].type==="header"?45:269)+12,overscan:5});return n.useEffect(()=>{const a=()=>{if(t.current){const r=t.current.scrollTop;m(r),localStorage.setItem("scrollPosition",r.toString())}},s=t.current;return s&&s.addEventListener("scroll",a),()=>{s&&s.removeEventListener("scroll",a)}},[]),n.useEffect(()=>{t.current&&(t.current.scrollTop=i)},[i]),e.jsx("div",{ref:t,className:"h-[calc(100vh-180px)] overflow-y-auto",children:e.jsx("div",{style:{height:`${d.getTotalSize()}px`},className:"relative w-full",children:d.getVirtualItems().map(a=>{const s=o[a.index];return e.jsx("div",{style:{height:`${a.size}px`,transform:`translateY(${a.start}px)`},className:"absolute top-0 left-0 w-full",children:s.type==="header"?e.jsx("h2",{className:"mt-10 w-full scroll-m-20 border-b pb-2 font-semibold text-3xl tracking-tight transition-colors first:mt-0",children:s.data.row.getValue("set_details")}):e.jsx("div",{className:"flex justify-center gap-5",children:s.data.map(({row:r})=>e.jsx(G,{card:r.original},r.original.card_id))})},a.key)})})})}function O(){const{user:l}=n.use(y);return l?e.jsx("div",{className:"mx-auto flex max-w-[900px] flex-col gap-y-4",children:e.jsxs(I,{defaultValue:"all",children:[e.jsxs(P,{className:"m-auto mt-4 mb-8",children:[e.jsx(_,{value:"all",children:"All"}),v.map(t=>e.jsx(_,{value:t.id,children:t.name},`tab_trigger_${t.id}`))]}),e.jsx(j,{value:"all",children:e.jsx(C,{cards:z})}),v.map(t=>e.jsx(j,{value:t.id,children:e.jsx(C,{cards:t.cards},`tab_content_${t.id}`)},`tab_content_${t.id}`))]})}):null}export{O as default};
