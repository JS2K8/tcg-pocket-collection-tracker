import{e as M,j as e,I as R,r as o,U as T,C as D,f as S,D as b,h as y,i as L,L as k,B as v,M as F}from"./index-CkxF7y-l.js";import{T as V,a as E,b as N}from"./tabs-DhJwHeI2.js";import{e as I,b as $}from"./CardsDB-hsSywI_T.js";import{R as z}from"./RarityFilter-m7kVL3ZX.js";import{F as G,u as O,c as B,a as P,b as U,g as H,d as W}from"./FancyCard-Dnq8MYSc.js";import"./index-Lx8FxL6c.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],A=M("Plus",q),Y=({expansionFilter:t,setExpansionFilter:n})=>e.jsx(V,{value:t,onValueChange:s=>n(s),className:"w-full",children:e.jsxs(E,{className:"w-full flex-wrap h-auto lg:h-10",children:[e.jsx(N,{value:"all",children:"All"}),I.map(s=>e.jsx(N,{value:s.id,children:s.name},`tab_trigger_${s.id}`))]})});let _=null;const J=({setSearchValue:t})=>e.jsx(R,{type:"search",placeholder:"Search",className:"w-full md:w-48",onChange:n=>{_&&window.clearTimeout(_),_=window.setTimeout(()=>{t(n.target.value)},500)}}),j={};function K({card:t}){const{user:n,setIsLoginDialogOpen:s}=o.use(T),{ownedCards:u,setOwnedCards:m}=o.use(D);let i=o.useMemo(()=>{var a;return((a=u.find(c=>c.card_id===t.card_id))==null?void 0:a.amount_owned)||0},[u]);const[p,d]=o.useState(0);o.useEffect(()=>{d(i)},[i]);const r=o.useCallback(async(a,c)=>{i=Math.max(0,c),d(i),j[a]&&window.clearTimeout(j[a]),j[a]=window.setTimeout(async()=>{const h=await S(),w=u.find(f=>f.card_id===a);if(w)console.log("updating",w),w.amount_owned=Math.max(0,c),m([...u]),await h.updateDocument(b,y,w.$id,{amount_owned:w.amount_owned});else if(!w&&c>0){console.log("adding new card",a);const f=await h.createDocument(b,y,L.unique(),{email:n==null?void 0:n.email,card_id:a,amount_owned:c});m([...u,{$id:f.$id,email:f.email,card_id:f.card_id,amount_owned:f.amount_owned}])}},1e3)},[u,n,m,i]),g=o.useCallback(async a=>{if(!n){s(!0);return}await r(a,i+1)},[r]),l=o.useCallback(async a=>{if(!n){s(!0);return}await r(a,i-1)},[r]),x=async a=>{const c=a.target.value===""?0:Number.parseInt(a.target.value,10);!Number.isNaN(c)&&c>=0&&await r(t.card_id,c)};return e.jsxs("div",{className:"group flex w-fit flex-col items-center rounded-lg",children:[e.jsx(k,{viewTransition:!0,to:`/card/${t.card_id}`,state:{card:t},children:e.jsx(G,{card:t,selected:i>0})}),e.jsxs("p",{className:"max-w-[130px] overflow-hidden text-ellipsis whitespace-nowrap font-semibold text-[12px] pt-2",children:[t.card_id," - ",t.name]}),e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsx(v,{variant:"ghost",size:"icon",onClick:()=>l(t.card_id),className:"rounded-full",children:e.jsx(F,{})}),e.jsx("input",{min:"0",max:"99",type:"text",value:p,onChange:x,className:"w-7 text-center border-none rounded",onFocus:a=>a.target.select()}),e.jsx(v,{variant:"ghost",size:"icon",className:"rounded-full",onClick:()=>g(t.card_id),children:e.jsx(A,{})})]})]})}const C=B();function Q({cards:t}){const n=o.useRef(null),{width:s}=O(),u=o.useMemo(()=>[C.accessor("image",{id:"imageUrl"}),C.accessor("card_id",{id:"card_id"}),C.accessor("name",{id:"name"}),C.accessor("set_details",{id:"set_details"})],[]),m=P({columns:u,data:t,enableGrouping:!0,getCoreRowModel:W(),getGroupedRowModel:H(),initialState:{grouping:["set_details"]}}),i=o.useMemo(()=>m.getGroupedRowModel().rows,[m.getGroupedRowModel().rows]);let p=5;s>800&&s<1e3?p=4:s<=800&&(p=3);const d=o.useMemo(()=>i.map(l=>{const x={type:"header",row:l},a=l.subRows.map(h=>({type:"data",row:h})),c=[];for(let h=0;h<a.length;h+=p)c.push(a.slice(h,h+p));return{header:x,gridRows:c}}),[i,p]),r=o.useMemo(()=>d.flatMap(l=>[{type:"header",height:60,data:l.header},...l.gridRows.map(x=>({type:"gridRow",height:250,data:x}))]),[d]),g=U({getScrollElement:()=>n.current,count:r.length,estimateSize:l=>(r[l].type==="header"?60:250)+12,overscan:5});return e.jsx("div",{ref:n,className:"h-[calc(100vh-270px)] overflow-y-auto",style:{scrollbarWidth:"none"},children:e.jsx("div",{style:{height:`${g.getTotalSize()}px`},className:"relative w-full",children:g.getVirtualItems().map(l=>{const x=r[l.index];return e.jsx("div",{style:{height:`${l.size}px`,transform:`translateY(${l.start}px)`},className:"absolute top-0 left-0 w-full",children:x.type==="header"?e.jsx("h2",{className:"mx-auto mt-10 text-center w-full max-w-[900px] scroll-m-20 border-b border-gray-200 pb-2 font-semibold text-3xl tracking-tight transition-colors first:mt-0",children:x.data.row.getValue("set_details")}):e.jsx("div",{className:"flex justify-center gap-x-3",children:x.data.map(({row:a})=>e.jsx(K,{card:a.original},a.original.card_id))})},l.key)})})})}function oe(){const[t,n]=o.useState(""),[s,u]=o.useState("all"),[m,i]=o.useState([]),p=o.useMemo(()=>{let d=$;return s!=="all"&&(d=d.filter(r=>r.expansion===s)),m.length>0&&(d=d.filter(r=>m.includes(r.rarity))),t&&(d=d.filter(r=>r.name.toLowerCase().includes(t.toLowerCase())||r.card_id.toLowerCase().includes(t.toLowerCase()))),d},[s,m,t]);return e.jsxs("div",{className:"flex flex-col gap-y-1 mx-auto max-w-[900px]",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-col md:flex-row px-8",children:[e.jsx(J,{setSearchValue:n}),e.jsx(Y,{expansionFilter:s,setExpansionFilter:u})]}),e.jsx("div",{className:"px-8 pb-8",children:e.jsx(z,{setRarityFilter:i})}),e.jsx(Q,{cards:p})]})}export{oe as default};
