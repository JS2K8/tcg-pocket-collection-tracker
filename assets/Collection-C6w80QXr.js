import{e as F,j as e,I as S,r as n,U as D,C as M,f as L,D as y,h as v,i as k,L as V,B as N,M as E}from"./index-B1V_cZYA.js";import{T as R,a as T,b as C}from"./tabs-3PpsU2AR.js";import{e as I,b as O}from"./CardsDB-9ENfkm57.js";import{R as $}from"./RarityFilter-Dg8oJG3c.js";import{F as z,u as G,c as B,a as P,b as U,g as A,d as H}from"./FancyCard-Bc4oI5T3.js";import"./index-BGywCc2d.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],q=F("Plus",W),Y=({expansionFilter:s,setExpansionFilter:r})=>e.jsx(R,{value:s,onValueChange:o=>r(o),className:"w-full",children:e.jsxs(T,{className:"w-full flex-wrap h-auto lg:h-[40px] border-2 border-slate-600 rounded-md",children:[e.jsx(C,{value:"all",children:"All"}),I.map(o=>e.jsx(C,{value:o.id,children:o.name},`tab_trigger_${o.id}`))]})}),J=({ownedFilter:s,setOwnedFilter:r})=>e.jsx(R,{value:s,onValueChange:o=>r(o),className:"w-50",children:e.jsxs(T,{className:"w-full flex-wrap h-auto lg:h-10 bg-neutral-50 border-2 border-slate-600 rounded-md",children:[e.jsx(C,{value:"all",children:"All"}),e.jsx(C,{value:"missing",children:"Missing"}),e.jsx(C,{value:"owned",children:"Owned"})]})});let b=null;const K=({setSearchValue:s})=>e.jsx(S,{type:"search",placeholder:"Search...",className:"w-full md:w-64 border-2 h-[38px]",style:{borderColor:"#45556C"},onChange:r=>{b&&window.clearTimeout(b),b=window.setTimeout(()=>{s(r.target.value)},500)}}),j={};function Q({card:s}){const{user:r,setIsLoginDialogOpen:o}=n.use(D),{ownedCards:d,setOwnedCards:w}=n.use(M);let i=n.useMemo(()=>{var a;return((a=d.find(c=>c.card_id===s.card_id))==null?void 0:a.amount_owned)||0},[d]);const[x,u]=n.useState(0);n.useEffect(()=>{u(i)},[i]);const m=n.useCallback(async(a,c)=>{i=Math.max(0,c),u(i),j[a]&&window.clearTimeout(j[a]),j[a]=window.setTimeout(async()=>{const p=await L(),h=d.find(g=>g.card_id===a);if(h)console.log("updating",h),h.amount_owned=Math.max(0,c),w([...d]),await p.updateDocument(y,v,h.$id,{amount_owned:h.amount_owned});else if(!h&&c>0){console.log("adding new card",a);const g=await p.createDocument(y,v,k.unique(),{email:r==null?void 0:r.email,card_id:a,amount_owned:c});w([...d,{$id:g.$id,email:g.email,card_id:g.card_id,amount_owned:g.amount_owned}])}},1e3)},[d,r,w,i]),f=n.useCallback(async a=>{if(!r){o(!0);return}await m(a,i+1)},[m]),t=n.useCallback(async a=>{if(!r){o(!0);return}await m(a,i-1)},[m]),l=async a=>{const c=a.target.value===""?0:Number.parseInt(a.target.value,10);!Number.isNaN(c)&&c>=0&&await m(s.card_id,c)};return e.jsxs("div",{className:"group flex w-fit flex-col items-center rounded-lg",children:[e.jsx(V,{viewTransition:!0,to:`/card/${s.card_id}`,state:{card:s},children:e.jsx(z,{card:s,selected:i>0})}),e.jsxs("p",{className:"max-w-[130px] overflow-hidden text-ellipsis whitespace-nowrap font-semibold text-[12px] pt-2",children:[s.card_id," - ",s.name]}),e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsx(N,{variant:"ghost",size:"icon",onClick:()=>t(s.card_id),className:"rounded-full",children:e.jsx(E,{})}),e.jsx("input",{min:"0",max:"99",type:"text",value:x,onChange:l,className:"w-7 text-center border-none rounded",onFocus:a=>a.target.select()}),e.jsx(N,{variant:"ghost",size:"icon",className:"rounded-full",onClick:()=>f(s.card_id),children:e.jsx(q,{})})]})]})}const _=B();function X({cards:s}){const r=n.useRef(null),{width:o}=G(),d=n.useMemo(()=>[_.accessor("image",{id:"imageUrl"}),_.accessor("card_id",{id:"card_id"}),_.accessor("name",{id:"name"}),_.accessor("set_details",{id:"set_details"})],[]),w=P({columns:d,data:s,enableGrouping:!0,getCoreRowModel:H(),getGroupedRowModel:A(),initialState:{grouping:["set_details"]}}),i=n.useMemo(()=>w.getGroupedRowModel().rows,[w.getGroupedRowModel().rows]);let x=5;o>800&&o<1e3?x=4:o<=800&&(x=3);const u=n.useMemo(()=>i.map(t=>{const l={type:"header",row:t},a=t.subRows.map(p=>({type:"data",row:p})),c=[];for(let p=0;p<a.length;p+=x)c.push(a.slice(p,p+x));return{header:l,gridRows:c}}),[i,x]),m=n.useMemo(()=>u.flatMap(t=>[{type:"header",height:60,data:t.header},...t.gridRows.map(l=>({type:"gridRow",height:250,data:l}))]),[u]),f=U({getScrollElement:()=>r.current,count:m.length,estimateSize:t=>(m[t].type==="header"?60:250)+12,overscan:5});return e.jsx("div",{ref:r,className:"h-[calc(100vh-270px)] overflow-y-auto",style:{scrollbarWidth:"none"},children:e.jsx("div",{style:{height:`${f.getTotalSize()}px`},className:"relative w-full",children:f.getVirtualItems().map(t=>{const l=m[t.index];return e.jsx("div",{style:{height:`${t.size}px`,transform:`translateY(${t.start}px)`},className:"absolute top-0 left-0 w-full",children:l.type==="header"?e.jsx("h2",{className:"mx-auto mt-10 text-center w-full max-w-[900px] scroll-m-20 border-b-2 border-slate-600 pb-2 font-semibold text-3xl tracking-tight transition-colors first:mt-0",children:l.data.row.getValue("set_details")}):e.jsx("div",{className:"flex justify-center gap-x-3",children:l.data.map(({row:a})=>e.jsx(Q,{card:a.original},a.original.card_id))})},t.key)})})})}function le(){const{ownedCards:s}=n.use(M),[r,o]=n.useState(""),[d,w]=n.useState("all"),[i,x]=n.useState([]),[u,m]=n.useState("all"),f=n.useMemo(()=>{let t=O;return d!=="all"&&(t=t.filter(l=>l.expansion===d)),u!=="all"&&(u==="owned"?t=t.filter(l=>s.find(a=>a.card_id===l.card_id&&a.amount_owned>0)):u==="missing"&&(t=t.filter(l=>!s.find(a=>a.card_id===l.card_id)))),i.length>0&&(t=t.filter(l=>i.includes(l.rarity))),r&&(t=t.filter(l=>l.name.toLowerCase().includes(r.toLowerCase())||l.card_id.toLowerCase().includes(r.toLowerCase()))),t},[d,i,r,u,s]);return e.jsxs("div",{className:"flex flex-col gap-y-1 mx-auto max-w-[900px]",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-col md:flex-row px-8",children:[e.jsx(K,{setSearchValue:o}),e.jsx(Y,{expansionFilter:d,setExpansionFilter:w})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2 flex-col md:flex-row px-8 pb-8",children:[e.jsx(J,{ownedFilter:u,setOwnedFilter:m}),e.jsx($,{setRarityFilter:x})]}),e.jsx(X,{cards:f})]})}export{le as default};
