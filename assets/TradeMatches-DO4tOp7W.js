import{u as L,V as z,T as G,r as o,U as V,o as q,G as T,b0 as J,b7 as Q,b1 as X,j as e,D as Y,t as Z,v as $,x as A,y as ee,z as se,B as ae,b3 as te,aA as S}from"./index-BnNV1Qet.js";import{u as re,s as ie,g as ne,F as le,a as D,b as k,d as M,c as I,S as oe,e as ce}from"./SocialShareButtons-eN1k3ZGs.js";import{N as E}from"./RarityFilter-D5jC6Sw1.js";import{M as N,C as b}from"./index-C0uFlnXu.js";import"./index-C8UlwGCs.js";import"./index-DXHGqulE.js";const v=["◊","◊◊","◊◊◊","◊◊◊◊","☆"],je=({ownedCards:d,friendCards:x,ownCollection:g,friendAccount:n})=>{const{t}=L("trade-matches"),p=z(),P=G(),{user:w,account:l,setAccount:O}=o.useContext(V),[y,F]=o.useState(!1),[u,B]=o.useState(0),[h,H]=o.useState(2);o.useEffect(()=>{p.pathname.includes("/collection")&&p.pathname.includes("/trade")?y||F(!0):F(!1)},[p]);const C=o.useMemo(()=>q.filter(s=>s.tradeable).map(s=>s.id),[]),j=o.useMemo(()=>{const s={"◊":[],"◊◊":[],"◊◊◊":[],"◊◊◊◊":[],"☆":[],"☆☆":[],"☆☆☆":[],"✵":[],"✵✵":[],"Crown Rare":[],P:[],"":[]},r=x.filter(a=>a.amount_owned>=((n==null?void 0:n.min_number_of_cards_to_keep)||1)+1),c=new Set(d.filter(a=>a.amount_owned>u).map(a=>a.card_id)),m=r.filter(a=>!c.has(a.card_id));for(const a of m){const i=T(a.card_id);i&&v.includes(i.rarity)&&C.includes(i.expansion)&&s[i.rarity].push({...i,amount_owned:a.amount_owned})}return s},[d,x,u,h]),_=o.useMemo(()=>{const s={"◊":[],"◊◊":[],"◊◊◊":[],"◊◊◊◊":[],"☆":[],"☆☆":[],"☆☆☆":[],"✵":[],"✵✵":[],"Crown Rare":[],P:[],"":[]},r=d.filter(a=>a.amount_owned>=h),c=new Set(x.filter(a=>a.amount_owned>0).map(a=>a.card_id)),m=r.filter(a=>!c.has(a.card_id));for(const a of m){const i=T(a.card_id);i&&v.includes(i.rarity)&&C.includes(i.expansion)&&s[i.rarity].push({...i,amount_owned:a.amount_owned})}return s},[d,x,u,h]),U=o.useMemo(()=>v.some(s=>j[s].length>0&&_[s].length>0),[j,_]),W=J({is_active_trading:X(),min_number_of_cards_to_keep:Q.number().min(1).max(10)}),f=re({resolver:ie(W),values:{is_active_trading:(l==null?void 0:l.is_active_trading)||!1,min_number_of_cards_to_keep:(l==null?void 0:l.min_number_of_cards_to_keep)||1}}),K=async s=>{try{const r=await te.from("accounts").upsert({email:w==null?void 0:w.user.email,username:l==null?void 0:l.username,is_active_trading:s.is_active_trading,min_number_of_cards_to_keep:s.min_number_of_cards_to_keep}).select().single();if(!r.data)throw console.error("Could not save account",l),new Error("Could not save account");O(r.data),S({title:"Account saved.",variant:"default"})}catch(r){console.error("error saving account",r),S({title:"Error saving your account.",variant:"destructive"})}},R=()=>g?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-xl ",children:t("ownCollection")}),e.jsx("p",{className:"text-sm text-gray-300 mt-2",children:t("ownCollectionDescription")}),e.jsx(le,{...f,children:e.jsx("form",{onSubmit:f.handleSubmit(K),className:"mt-8 flex justify-center",children:e.jsxs("div",{className:"border-1 border-neutral-700 p-4 space-y-2",children:[e.jsx(D,{control:f.control,name:"is_active_trading",render:({field:s})=>e.jsx(k,{className:"flex flex-col items-start",children:e.jsx(M,{children:e.jsxs("div",{className:"flex items-center gap-x-4 flex-wrap",children:[e.jsx(I,{className:"flex sm:w-72",children:t("isActiveTrading")}),e.jsx("div",{className:"grow-1",children:e.jsx(oe,{checked:s.value,onCheckedChange:s.onChange})}),e.jsx(ce,{className:"grow",children:s.value?"active":"disabled"}),e.jsx(N,{id:"activeInput",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(b,{className:"h-4 w-4","data-tooltip-id":"activeInput","data-tooltip-content":t("activeTradingInputTooltip")})]})})})}),e.jsx(D,{control:f.control,name:"min_number_of_cards_to_keep",render:({field:s})=>e.jsx(k,{className:"flex flex-col items-start",children:e.jsx(M,{children:e.jsxs("div",{className:"flex items-center gap-x-4 flex-wrap",children:[e.jsx(I,{className:"flex sm:w-72",children:t("minNumberOfCardsToKeep")}),e.jsx("div",{className:"grow-1",children:e.jsx(se,{type:"number",...s})}),e.jsx(N,{id:"minInput",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(b,{className:"h-4 w-4","data-tooltip-id":"minInput","data-tooltip-content":t("minInputTooltip")})]})})})}),e.jsx("div",{className:"w-full flex justify-end mt-8",children:e.jsx(ae,{type:"submit",children:t("save")})})]})})})]}):n!=null&&n.is_active_trading?U?v.map(s=>j[s].length>0&&_[s].length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:s}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-medium mb-2",children:t("friendHas")}),e.jsx("div",{className:"border rounded p-2 max-h-60 overflow-y-auto",children:e.jsx("ul",{className:"space-y-1",children:j[s].map(r=>{var c;return e.jsxs("li",{className:"flex justify-between",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsxs("span",{className:"min-w-14 me-4",children:[r.card_id," "]}),e.jsx("span",{children:r.name})]}),e.jsx("span",{title:"Amount you own",className:"text-gray-500",children:e.jsxs("span",{style:{userSelect:"none"},children:["×",((c=d.find(m=>m.card_id===r.card_id))==null?void 0:c.amount_owned)||0]})})]},r.card_id)})})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-medium mb-2",children:t("youHave")}),e.jsx("div",{className:"border rounded p-2 max-h-60 overflow-y-auto",children:e.jsx("ul",{className:"space-y-1",children:_[s].map(r=>e.jsxs("li",{className:"flex justify-between",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx("span",{className:"min-w-14 me-4",children:r.card_id}),e.jsx("span",{children:r.name})]}),e.jsx("span",{title:"Amount your friend owns",className:"text-gray-500",children:e.jsxs("span",{style:{userSelect:"none"},children:["×",r.amount_owned]})})]},r.card_id))})})]})]})]},s)):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-xl ",children:t("noPossibleTrades")}),e.jsx("p",{className:"text-sm text-gray-300 mt-2",children:t("noPossibleTradesDescription")})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-xl ",children:t("inActiveTradePage",{username:n==null?void 0:n.username})}),e.jsx("p",{className:"text-sm text-gray-300 mt-2",children:t("inActiveTradeDescription")})]});return e.jsx(Y,{open:y,onOpenChange:s=>{s||P(p.pathname.replace("/trade",""))},children:e.jsxs(Z,{className:"border-1 border-neutral-700 shadow-none max-w-4xl h-[90vh] content-start flex flex-col",children:[e.jsx($,{children:e.jsx(A,{children:t("title")})}),e.jsxs("div",{className:"flex flex-col gap-4 grow",children:[e.jsx("p",{className:"pb-2",children:t("featureDescription")}),e.jsx("p",{className:"pb-2",children:t("friendAccountDetails",{...n})}),!g&&e.jsxs("div",{className:"flex flex-row gap-4 mb-4 justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{numberFilter:u,setNumberFilter:B,options:[0,1,2,3,4,5],labelKey:"maxNum"}),e.jsx(N,{id:"minFilter",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(b,{className:"h-4 w-4","data-tooltip-id":"minFilter","data-tooltip-content":t("minFilterTooltip")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{id:"maxFilter",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(b,{className:"h-4 w-4","data-tooltip-id":"maxFilter","data-tooltip-content":t("maxFilterTooltip")}),e.jsx(E,{numberFilter:h,setNumberFilter:H,options:[2,3,4,5],labelKey:"minNum"})]})]}),R()]}),g&&e.jsx(ee,{children:e.jsx(ne,{})})]})})};export{je as default};
