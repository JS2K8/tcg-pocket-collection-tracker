import{u as L,W as q,V,r as o,U as G,q as J,H as T,b0 as y,j as e,D as Q,v as X,x as Y,y as Z,z as $,A,B as ee,b1 as se,b4 as D}from"./index-D5pMD5mv.js";import{u as ae,s as te,g as re,F as ne,a as k,b as M,d as I,c as E,S as ie,e as le}from"./SocialShareButtons-WHGDxdHO.js";import{N as P}from"./RarityFilter-CRe7zbjx.js";import{M as N,C as b}from"./index-spC6pW-e.js";import"./index-1_MWJk9N.js";const v=["◊","◊◊","◊◊◊","◊◊◊◊","☆"],pe=({ownedCards:d,friendCards:x,ownCollection:g,friendAccount:i})=>{const{t}=L("trade-matches"),p=q(),H=V(),{user:w,account:l,setAccount:O}=o.useContext(G),[F,C]=o.useState(!1),[u,W]=o.useState(0),[h,B]=o.useState(2);o.useEffect(()=>{p.pathname.includes("/collection")&&p.pathname.includes("/trade")?F||C(!0):C(!1)},[p]);const S=o.useMemo(()=>J.filter(s=>s.tradeable).map(s=>s.id),[]),j=o.useMemo(()=>{const s={"◊":[],"◊◊":[],"◊◊◊":[],"◊◊◊◊":[],"☆":[],"☆☆":[],"☆☆☆":[],"✵":[],"✵✵":[],"Crown Rare":[],P:[],"":[]},r=x.filter(a=>a.amount_owned>=((i==null?void 0:i.min_number_of_cards_to_keep)||1)+1),c=new Set(d.filter(a=>a.amount_owned>u).map(a=>a.card_id)),m=r.filter(a=>!c.has(a.card_id));for(const a of m){const n=T(a.card_id);n&&v.includes(n.rarity)&&S.includes(n.expansion)&&s[n.rarity].push({...n,amount_owned:a.amount_owned})}return s},[d,x,u,h]),_=o.useMemo(()=>{const s={"◊":[],"◊◊":[],"◊◊◊":[],"◊◊◊◊":[],"☆":[],"☆☆":[],"☆☆☆":[],"✵":[],"✵✵":[],"Crown Rare":[],P:[],"":[]},r=d.filter(a=>a.amount_owned>=h),c=new Set(x.filter(a=>a.amount_owned>0).map(a=>a.card_id)),m=r.filter(a=>!c.has(a.card_id));for(const a of m){const n=T(a.card_id);n&&v.includes(n.rarity)&&S.includes(n.expansion)&&s[n.rarity].push({...n,amount_owned:a.amount_owned})}return s},[d,x,u,h]),U=o.useMemo(()=>v.some(s=>j[s].length>0&&_[s].length>0),[j,_]),K=y.object({is_active_trading:y.boolean(),min_number_of_cards_to_keep:y.coerce.number().min(1).max(10)}),f=ae({resolver:te(K),values:{is_active_trading:(l==null?void 0:l.is_active_trading)||!1,min_number_of_cards_to_keep:(l==null?void 0:l.min_number_of_cards_to_keep)||1}}),R=async s=>{try{const r=await se.from("accounts").upsert({email:w==null?void 0:w.user.email,username:l==null?void 0:l.username,is_active_trading:s.is_active_trading,min_number_of_cards_to_keep:s.min_number_of_cards_to_keep}).select().single();if(!r.data)throw console.error("Could not save account",l),new Error("Could not save account");O(r.data),D({title:"Account saved.",variant:"default"})}catch(r){console.error("error saving account",r),D({title:"Error saving your account.",variant:"destructive"})}},z=()=>g?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-xl ",children:t("ownCollection")}),e.jsx("p",{className:"text-sm text-gray-300 mt-2",children:t("ownCollectionDescription")}),e.jsx(ne,{...f,children:e.jsx("form",{onSubmit:f.handleSubmit(R),className:"mt-8 flex justify-center",children:e.jsxs("div",{className:"border-1 border-neutral-700 p-4 space-y-2",children:[e.jsx(k,{control:f.control,name:"is_active_trading",render:({field:s})=>e.jsx(M,{className:"flex flex-col items-start",children:e.jsx(I,{children:e.jsxs("div",{className:"flex items-center gap-x-4 flex-wrap",children:[e.jsx(E,{className:"flex sm:w-72",children:t("isActiveTrading")}),e.jsx("div",{className:"grow-1",children:e.jsx(ie,{checked:s.value,onCheckedChange:s.onChange})}),e.jsx(le,{className:"grow",children:s.value?"active":"disabled"}),e.jsx(N,{id:"activeInput",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(b,{className:"h-4 w-4","data-tooltip-id":"activeInput","data-tooltip-content":t("activeTradingInputTooltip")})]})})})}),e.jsx(k,{control:f.control,name:"min_number_of_cards_to_keep",render:({field:s})=>e.jsx(M,{className:"flex flex-col items-start",children:e.jsx(I,{children:e.jsxs("div",{className:"flex items-center gap-x-4 flex-wrap",children:[e.jsx(E,{className:"flex sm:w-72",children:t("minNumberOfCardsToKeep")}),e.jsx("div",{className:"grow-1",children:e.jsx(A,{type:"number",...s})}),e.jsx(N,{id:"minInput",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(b,{className:"h-4 w-4","data-tooltip-id":"minInput","data-tooltip-content":t("minInputTooltip")})]})})})}),e.jsx("div",{className:"w-full flex justify-end mt-8",children:e.jsx(ee,{type:"submit",children:t("save")})})]})})})]}):i!=null&&i.is_active_trading?U?v.map(s=>j[s].length>0&&_[s].length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:s}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-medium mb-2",children:t("friendHas")}),e.jsx("div",{className:"border rounded p-2 max-h-60 overflow-y-auto",children:e.jsx("ul",{className:"space-y-1",children:j[s].map(r=>{var c;return e.jsxs("li",{className:"flex justify-between",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsxs("span",{className:"min-w-14 me-4",children:[r.card_id," "]}),e.jsx("span",{children:r.name})]}),e.jsx("span",{title:"Amount you own",className:"text-gray-500",children:e.jsxs("span",{style:{userSelect:"none"},children:["×",((c=d.find(m=>m.card_id===r.card_id))==null?void 0:c.amount_owned)||0]})})]},r.card_id)})})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-medium mb-2",children:t("youHave")}),e.jsx("div",{className:"border rounded p-2 max-h-60 overflow-y-auto",children:e.jsx("ul",{className:"space-y-1",children:_[s].map(r=>e.jsxs("li",{className:"flex justify-between",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx("span",{className:"min-w-14 me-4",children:r.card_id}),e.jsx("span",{children:r.name})]}),e.jsx("span",{title:"Amount your friend owns",className:"text-gray-500",children:e.jsxs("span",{style:{userSelect:"none"},children:["×",r.amount_owned]})})]},r.card_id))})})]})]})]},s)):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-xl ",children:t("noPossibleTrades")}),e.jsx("p",{className:"text-sm text-gray-300 mt-2",children:t("noPossibleTradesDescription")})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-xl ",children:t("inActiveTradePage",{username:i==null?void 0:i.username})}),e.jsx("p",{className:"text-sm text-gray-300 mt-2",children:t("inActiveTradeDescription")})]});return e.jsx(Q,{open:F,onOpenChange:s=>{s||H(p.pathname.replace("/trade",""))},children:e.jsxs(X,{className:"border-1 border-neutral-700 shadow-none max-w-4xl h-[90vh] content-start flex flex-col",children:[e.jsx(Y,{children:e.jsx(Z,{children:t("title")})}),e.jsxs("div",{className:"flex flex-col gap-4 grow",children:[e.jsx("p",{className:"pb-2",children:t("featureDescription")}),e.jsx("p",{className:"pb-2",children:t("friendAccountDetails",{...i})}),!g&&e.jsxs("div",{className:"flex flex-row gap-4 mb-4 justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{numberFilter:u,setNumberFilter:W,options:[0,1,2,3,4,5],labelKey:"maxNum"}),e.jsx(N,{id:"minFilter",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(b,{className:"h-4 w-4","data-tooltip-id":"minFilter","data-tooltip-content":t("minFilterTooltip")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{id:"maxFilter",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(b,{className:"h-4 w-4","data-tooltip-id":"maxFilter","data-tooltip-content":t("maxFilterTooltip")}),e.jsx(P,{numberFilter:h,setNumberFilter:B,options:[2,3,4,5],labelKey:"minNum"})]})]}),z()]}),g&&e.jsx($,{children:e.jsx(re,{})})]})})};export{pe as default};
