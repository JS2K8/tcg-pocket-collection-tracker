import{e as F,j as e,I as S,r,U as D,C as M,f as L,D as y,h as v,i as k,L as V,B as N,M as E}from"./index-nx5fDTcr.js";import{T as R,a as T,b as C}from"./tabs-BcYZozHX.js";import{e as I,b as O}from"./CardsDB-hsSywI_T.js";import{R as $}from"./RarityFilter-CAldyMck.js";import{F as z,u as G,c as B,a as P,b as U,g as A,d as H}from"./FancyCard-C4NIRAfJ.js";import"./index-CPF7we0Z.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],q=F("Plus",W),Y=({expansionFilter:s,setExpansionFilter:l})=>e.jsx(R,{value:s,onValueChange:i=>l(i),className:"w-full",children:e.jsxs(T,{className:"w-full flex-wrap h-auto lg:h-10",children:[e.jsx(C,{value:"all",children:"All"}),I.map(i=>e.jsx(C,{value:i.id,children:i.name},`tab_trigger_${i.id}`))]})}),J=({ownedFilter:s,setOwnedFilter:l})=>e.jsx(R,{value:s,onValueChange:i=>l(i),className:"w-50",children:e.jsxs(T,{className:"w-full flex-wrap h-auto lg:h-10 bg-neutral-50",children:[e.jsx(C,{value:"all",children:"All"}),e.jsx(C,{value:"missing",children:"Missing"}),e.jsx(C,{value:"owned",children:"Owned"})]})});let _=null;const K=({setSearchValue:s})=>e.jsx(S,{type:"search",placeholder:"Search",className:"w-full md:w-64",onChange:l=>{_&&window.clearTimeout(_),_=window.setTimeout(()=>{s(l.target.value)},500)}}),b={};function Q({card:s}){const{user:l,setIsLoginDialogOpen:i}=r.use(D),{ownedCards:d,setOwnedCards:p}=r.use(M);let o=r.useMemo(()=>{var a;return((a=d.find(c=>c.card_id===s.card_id))==null?void 0:a.amount_owned)||0},[d]);const[x,u]=r.useState(0);r.useEffect(()=>{u(o)},[o]);const m=r.useCallback(async(a,c)=>{o=Math.max(0,c),u(o),b[a]&&window.clearTimeout(b[a]),b[a]=window.setTimeout(async()=>{const w=await L(),h=d.find(g=>g.card_id===a);if(h)console.log("updating",h),h.amount_owned=Math.max(0,c),p([...d]),await w.updateDocument(y,v,h.$id,{amount_owned:h.amount_owned});else if(!h&&c>0){console.log("adding new card",a);const g=await w.createDocument(y,v,k.unique(),{email:l==null?void 0:l.email,card_id:a,amount_owned:c});p([...d,{$id:g.$id,email:g.email,card_id:g.card_id,amount_owned:g.amount_owned}])}},1e3)},[d,l,p,o]),f=r.useCallback(async a=>{if(!l){i(!0);return}await m(a,o+1)},[m]),t=r.useCallback(async a=>{if(!l){i(!0);return}await m(a,o-1)},[m]),n=async a=>{const c=a.target.value===""?0:Number.parseInt(a.target.value,10);!Number.isNaN(c)&&c>=0&&await m(s.card_id,c)};return e.jsxs("div",{className:"group flex w-fit flex-col items-center rounded-lg",children:[e.jsx(V,{viewTransition:!0,to:`/card/${s.card_id}`,state:{card:s},children:e.jsx(z,{card:s,selected:o>0})}),e.jsxs("p",{className:"max-w-[130px] overflow-hidden text-ellipsis whitespace-nowrap font-semibold text-[12px] pt-2",children:[s.card_id," - ",s.name]}),e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsx(N,{variant:"ghost",size:"icon",onClick:()=>t(s.card_id),className:"rounded-full",children:e.jsx(E,{})}),e.jsx("input",{min:"0",max:"99",type:"text",value:x,onChange:n,className:"w-7 text-center border-none rounded",onFocus:a=>a.target.select()}),e.jsx(N,{variant:"ghost",size:"icon",className:"rounded-full",onClick:()=>f(s.card_id),children:e.jsx(q,{})})]})]})}const j=B();function X({cards:s}){const l=r.useRef(null),{width:i}=G(),d=r.useMemo(()=>[j.accessor("image",{id:"imageUrl"}),j.accessor("card_id",{id:"card_id"}),j.accessor("name",{id:"name"}),j.accessor("set_details",{id:"set_details"})],[]),p=P({columns:d,data:s,enableGrouping:!0,getCoreRowModel:H(),getGroupedRowModel:A(),initialState:{grouping:["set_details"]}}),o=r.useMemo(()=>p.getGroupedRowModel().rows,[p.getGroupedRowModel().rows]);let x=5;i>800&&i<1e3?x=4:i<=800&&(x=3);const u=r.useMemo(()=>o.map(t=>{const n={type:"header",row:t},a=t.subRows.map(w=>({type:"data",row:w})),c=[];for(let w=0;w<a.length;w+=x)c.push(a.slice(w,w+x));return{header:n,gridRows:c}}),[o,x]),m=r.useMemo(()=>u.flatMap(t=>[{type:"header",height:60,data:t.header},...t.gridRows.map(n=>({type:"gridRow",height:250,data:n}))]),[u]),f=U({getScrollElement:()=>l.current,count:m.length,estimateSize:t=>(m[t].type==="header"?60:250)+12,overscan:5});return e.jsx("div",{ref:l,className:"h-[calc(100vh-270px)] overflow-y-auto",style:{scrollbarWidth:"none"},children:e.jsx("div",{style:{height:`${f.getTotalSize()}px`},className:"relative w-full",children:f.getVirtualItems().map(t=>{const n=m[t.index];return e.jsx("div",{style:{height:`${t.size}px`,transform:`translateY(${t.start}px)`},className:"absolute top-0 left-0 w-full",children:n.type==="header"?e.jsx("h2",{className:"mx-auto mt-10 text-center w-full max-w-[900px] scroll-m-20 border-b border-gray-200 pb-2 font-semibold text-3xl tracking-tight transition-colors first:mt-0",children:n.data.row.getValue("set_details")}):e.jsx("div",{className:"flex justify-center gap-x-3",children:n.data.map(({row:a})=>e.jsx(Q,{card:a.original},a.original.card_id))})},t.key)})})})}function ne(){const{ownedCards:s}=r.use(M),[l,i]=r.useState(""),[d,p]=r.useState("all"),[o,x]=r.useState([]),[u,m]=r.useState("all"),f=r.useMemo(()=>{let t=O;return d!=="all"&&(t=t.filter(n=>n.expansion===d)),u!=="all"&&(u==="owned"?t=t.filter(n=>s.find(a=>a.card_id===n.card_id)):u==="missing"&&(t=t.filter(n=>!s.find(a=>a.card_id===n.card_id)))),o.length>0&&(t=t.filter(n=>o.includes(n.rarity))),l&&(t=t.filter(n=>n.name.toLowerCase().includes(l.toLowerCase())||n.card_id.toLowerCase().includes(l.toLowerCase()))),t},[d,o,l,u,s]);return e.jsxs("div",{className:"flex flex-col gap-y-1 mx-auto max-w-[900px]",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-col md:flex-row px-8",children:[e.jsx(K,{setSearchValue:i}),e.jsx(Y,{expansionFilter:d,setExpansionFilter:p})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2 flex-col md:flex-row px-8 pb-8",children:[e.jsx(J,{ownedFilter:u,setOwnedFilter:m}),e.jsx($,{setRarityFilter:x})]}),e.jsx(X,{cards:f})]})}export{ne as default};
