import{j as e,r as m,e as R,D as j,C as _,I as S}from"./index-Df4Gm_in.js";import{T,a as E,b as v,c as y,d as M,u as $,e as D,g as P,f as k,F as I}from"./FancyCard-CEDX7eFx.js";import{e as C,a as z}from"./CardsDB-CwQ6NIp-.js";const A=({title:l})=>e.jsx("h2",{className:"mt-10 w-full scroll-m-20 border-b pb-2 text-3xl font-semibold tracking-tight transition-colors first:mt-0",children:l}),g=M(),G=({user:l,ownedCards:c,setOwnedCards:h})=>{const x=async(t,s)=>{console.log(`${t} button clicked`);const n=await R(),r=c.find(i=>i.card_id===t);if(r)console.log("updating",r),r.amount_owned=Math.max(0,r.amount_owned+s),h([...c]),await n.updateDocument(j,_,r.$id,{amount_owned:r.amount_owned});else if(!r&&s>0){console.log("adding new card",t);const i=await n.createDocument(j,_,S.unique(),{email:l==null?void 0:l.email,card_id:t,amount_owned:s});h([...c,{$id:i.$id,email:i.email,card_id:i.card_id,amount_owned:i.amount_owned}])}},N=({card:t})=>{var n;const s=((n=c.find(r=>r.card_id===t.card_id))==null?void 0:n.amount_owned)||0;return e.jsxs("div",{className:"flex flex-col items-center gap-y-2 w-fit border border-gray-700 p-4 rounded-lg shadow-md hover:shadow-lg transition duration-200 group",children:[e.jsx(I,{card:t,selected:s>0,setIsSelected:()=>{}}),e.jsxs("p",{className:"text-[12px] font-semibold whitespace-nowrap overflow-hidden text-ellipsis max-w-[130px]",children:[t.card_id," - ",t.name]}),e.jsxs("div",{className:"flex items-center gap-x-4",children:[e.jsx("button",{type:"button",onClick:()=>x(t.card_id,-1),className:"flex items-center justify-center w-8 h-8 rounded-full bg-red-500 text-white hover:bg-red-400 transition duration-200 focus:outline-none",children:e.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{d:"M5 10a.75.75 0 0 1 .75-.75h8.5a.75.75 0 0 1 0 1.5h-8.5A.75.75 0 0 1 5 10z"})})}),e.jsx("span",{className:"text-lg font-semibold",children:s}),e.jsx("button",{type:"button",onClick:()=>x(t.card_id,1),className:"flex items-center justify-center w-8 h-8 rounded-full bg-green-500 text-white hover:bg-green-400 transition duration-200 focus:outline-none",children:e.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{d:"M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z"})})})]})]})},f=({cards:t})=>{const s=m.useRef(null),[n,r]=m.useState(()=>{const a=localStorage.getItem("scrollPosition");return a?Number.parseInt(a,10):0});m.useEffect(()=>{const a=()=>{if(s.current){const d=s.current.scrollTop;r(d),localStorage.setItem("scrollPosition",d.toString())}},o=s.current;return o&&o.addEventListener("scroll",a),()=>{o&&o.removeEventListener("scroll",a)}},[]),m.useEffect(()=>{s.current&&(s.current.scrollTop=n)},[n]);const i=m.useMemo(()=>[g.accessor("image",{id:"imageUrl"}),g.accessor("card_id",{id:"card_id"}),g.accessor("name",{id:"name"}),g.accessor("set_details",{id:"set_details"})],[]),p=$({columns:i,data:t,enableGrouping:!0,getCoreRowModel:k(),getGroupedRowModel:P(),initialState:{grouping:["set_details"]}}).getRowModel().rows.map(a=>{const o={type:"header",row:a},d=a.subRows.map(u=>({type:"data",row:u})),b=[];for(let u=0;u<d.length;u+=5)b.push(d.slice(u,u+5));return{header:o,gridRows:b}}).flatMap(a=>[{type:"header",height:45,data:a.header},...a.gridRows.map(o=>({type:"gridRow",height:269,data:o}))]),w=D({getScrollElement:()=>s.current,count:p.length,estimateSize:a=>(p[a].type==="header"?45:269)+12,overscan:5});return e.jsx("div",{ref:s,className:"h-[calc(100vh-180px)] overflow-y-auto",children:e.jsx("div",{style:{height:`${w.getTotalSize()}px`,position:"relative"},className:"w-full",children:w.getVirtualItems().map(a=>{const o=p[a.index];return e.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:`${a.size}px`,transform:`translateY(${a.start}px)`},children:o.type==="header"?e.jsx(A,{title:o.data.row.getValue("set_details")}):e.jsx("div",{className:"flex justify-center gap-5",children:o.data.map(({row:d})=>e.jsx(N,{card:d.original},d.original.card_id))})},a.key)})})})};return e.jsx("div",{className:"flex flex-col gap-y-4 max-w-[900px] mx-auto",children:e.jsxs(T,{defaultValue:"all",children:[e.jsxs(E,{className:"m-auto mt-4 mb-8",children:[e.jsx(v,{value:"all",children:"All"}),C.map(t=>e.jsx(v,{value:t.id,children:t.name},`tab_trigger_${t.id}`))]}),e.jsx(y,{value:"all",children:e.jsx(f,{cards:z})}),C.map(t=>e.jsx(y,{value:t.id,children:e.jsx(f,{cards:t.cards},`tab_content_${t.id}`)},t.id))]})})},q=({user:l,ownedCards:c,setOwnedCards:h})=>l?e.jsx(G,{user:l,ownedCards:c,setOwnedCards:h}):null;export{q as default};
