import{e as T,r as s,U as k,C as z,f as $,D as C,h as j,I as E,j as e,L,B as v,M as S}from"./index-CIPIfMhO.js";import{T as V,a as G,b as y,c as N}from"./tabs-CeYPxKV4.js";import{e as M,b as I}from"./CardsDB-DnIgziLH.js";import{F as O,c as W,u as P,a as B,g as F,b as H}from"./FancyCard-BicP9_d9.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],q=T("Plus",U);function R(){const{innerWidth:t,innerHeight:o}=window;return{width:t,height:o}}function A(){const[t,o]=s.useState(R());return s.useEffect(()=>{function l(){o(R())}return window.addEventListener("resize",l),()=>window.removeEventListener("resize",l)},[]),t}const b={};function Y({card:t}){const{user:o,setIsLoginDialogOpen:l}=s.use(k),{ownedCards:m,setOwnedCards:h}=s.use(z);let r=s.useMemo(()=>{var a;return((a=m.find(i=>i.card_id===t.card_id))==null?void 0:a.amount_owned)||0},[m]);const[w,g]=s.useState(0);s.useEffect(()=>{g(r)},[r]);const d=s.useCallback(async(a,i)=>{r=Math.max(0,i),g(r),b[a]&&window.clearTimeout(b[a]),b[a]=window.setTimeout(async()=>{const u=await $(),p=m.find(x=>x.card_id===a);if(p)console.log("updating",p),p.amount_owned=Math.max(0,i),h([...m]),await u.updateDocument(C,j,p.$id,{amount_owned:p.amount_owned});else if(!p&&i>0){console.log("adding new card",a);const x=await u.createDocument(C,j,E.unique(),{email:o==null?void 0:o.email,card_id:a,amount_owned:i});h([...m,{$id:x.$id,email:x.email,card_id:x.card_id,amount_owned:x.amount_owned}])}},1e3)},[m,o,h,r]),f=s.useCallback(async a=>{if(!o){l(!0);return}await d(a,r+1)},[d]),n=s.useCallback(async a=>{if(!o){l(!0);return}await d(a,r-1)},[d]),c=async a=>{const i=a.target.value===""?0:Number.parseInt(a.target.value,10);!Number.isNaN(i)&&i>=0&&await d(t.card_id,i)};return e.jsxs("div",{className:"group flex w-fit flex-col items-center rounded-lg",children:[e.jsx(L,{viewTransition:!0,to:`/card/${t.card_id}`,state:{card:t},children:e.jsx(O,{card:t,selected:r>0})}),e.jsxs("p",{className:"max-w-[130px] overflow-hidden text-ellipsis whitespace-nowrap font-semibold text-[12px] pt-2",children:[t.card_id," - ",t.name]}),e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsx(v,{variant:"ghost",size:"icon",onClick:()=>n(t.card_id),className:"rounded-full",children:e.jsx(S,{})}),e.jsx("input",{min:"0",max:"99",type:"text",value:w,onChange:c,className:"w-7 text-center border-none rounded",onFocus:a=>a.target.select()}),e.jsx(v,{variant:"ghost",size:"icon",className:"rounded-full",onClick:()=>f(t.card_id),children:e.jsx(q,{})})]})]})}const _=W();function D({cards:t}){const o=s.useRef(null),{width:l}=A(),m=s.useMemo(()=>[_.accessor("image",{id:"imageUrl"}),_.accessor("card_id",{id:"card_id"}),_.accessor("name",{id:"name"}),_.accessor("set_details",{id:"set_details"})],[]),h=P({columns:m,data:t,enableGrouping:!0,getCoreRowModel:H(),getGroupedRowModel:F(),initialState:{grouping:["set_details"]}}),r=s.useMemo(()=>h.getGroupedRowModel().rows,[h.getGroupedRowModel().rows]);let w=5;l>800&&l<1e3?w=4:l<=800&&(w=3);const g=s.useMemo(()=>r.map(n=>{const c={type:"header",row:n},a=n.subRows.map(u=>({type:"data",row:u})),i=[];for(let u=0;u<a.length;u+=w)i.push(a.slice(u,u+w));return{header:c,gridRows:i}}),[r,w]),d=s.useMemo(()=>g.flatMap(n=>[{type:"header",height:60,data:n.header},...n.gridRows.map(c=>({type:"gridRow",height:250,data:c}))]),[g]),f=B({getScrollElement:()=>o.current,count:d.length,estimateSize:n=>(d[n].type==="header"?60:250)+12,overscan:5});return e.jsx("div",{ref:o,className:"h-[calc(100vh-180px)] overflow-y-auto",style:{scrollbarWidth:"none"},children:e.jsx("div",{style:{height:`${f.getTotalSize()}px`},className:"relative w-full",children:f.getVirtualItems().map(n=>{const c=d[n.index];return e.jsx("div",{style:{height:`${n.size}px`,transform:`translateY(${n.start}px)`},className:"absolute top-0 left-0 w-full",children:c.type==="header"?e.jsx("h2",{className:"mt-10 text-center w-full scroll-m-20 border-b border-gray-200 pb-2 font-semibold text-3xl tracking-tight transition-colors first:mt-0",children:c.data.row.getValue("set_details")}):e.jsx("div",{className:"flex justify-center gap-x-3",children:c.data.map(({row:a})=>e.jsx(Y,{card:a.original},a.original.card_id))})},n.key)})})})}function Z(){return e.jsx("div",{className:"mx-auto flex max-w-[900px] flex-col gap-y-4 px-4",children:e.jsxs(V,{defaultValue:"all",children:[e.jsxs(G,{className:"w-full m-auto mt-4 mb-8 flex-wrap h-auto",children:[e.jsx(y,{value:"all",children:"All"}),M.map(t=>e.jsx(y,{value:t.id,children:t.name},`tab_trigger_${t.id}`))]}),e.jsx(N,{value:"all",children:e.jsx(D,{cards:I})}),M.map(t=>e.jsx(N,{value:t.id,children:e.jsx(D,{cards:t.cards},`tab_content_${t.id}`)},`tab_content_${t.id}`))]})})}export{Z as default};
