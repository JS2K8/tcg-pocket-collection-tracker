import{r as l,U as y,C as N,e as M,D as w,f as b,I as R,j as e}from"./index-DDe0y-HX.js";import{T,a as S,b as _,c as j}from"./tabs-Yq_Xhz5V.js";import{e as v,b as E}from"./CardsDB-CePrsvJ-.js";import{F as $,c as k,u as D,a as I,g as P,b as z}from"./FancyCard-D3eftZ15.js";function G({card:a}){const{user:r,setIsLoginDialogOpen:m}=l.use(y),{ownedCards:d,setOwnedCards:h}=l.use(N),g=l.useMemo(()=>{var n;return((n=d.find(t=>t.card_id===a.card_id))==null?void 0:n.amount_owned)||0},[d]),c=l.useCallback(async(n,t)=>{console.log(`${n} button clicked`);const o=await M(),s=d.find(i=>i.card_id===n);if(s)console.log("updating",s),s.amount_owned=Math.max(0,s.amount_owned+t),h([...d]),await o.updateDocument(w,b,s.$id,{amount_owned:s.amount_owned});else if(!s&&t>0){console.log("adding new card",n);const i=await o.createDocument(w,b,R.unique(),{email:r==null?void 0:r.email,card_id:n,amount_owned:t});h([...d,{$id:i.$id,email:i.email,card_id:i.card_id,amount_owned:i.amount_owned}])}},[d,r,h]),p=l.useCallback(async n=>{if(!r){m(!0);return}await c(n,1)},[c]),f=l.useCallback(async n=>{if(!r){m(!0);return}await c(n,-1)},[c]);return e.jsxs("div",{className:"group flex w-fit flex-col items-center gap-y-2 rounded-lg border border-gray-700 p-4 shadow-md transition duration-200 hover:shadow-lg",children:[e.jsx($,{card:a,selected:g>0}),e.jsxs("p",{className:"max-w-[130px] overflow-hidden text-ellipsis whitespace-nowrap font-semibold text-[12px]",children:[a.card_id," - ",a.name]}),e.jsxs("div",{className:"flex items-center gap-x-4",children:[e.jsx("button",{name:"remove","aria-label":"remove 1 card",type:"button",onClick:()=>f(a.card_id),className:"flex h-8 w-8 items-center justify-center rounded-full bg-red-500 text-white transition duration-200 hover:bg-red-400 focus:outline-none",children:e.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{d:"M5 10a.75.75 0 0 1 .75-.75h8.5a.75.75 0 0 1 0 1.5h-8.5A.75.75 0 0 1 5 10z"})})}),e.jsx("span",{className:"font-semibold text-lg",children:g}),e.jsx("button",{name:"add","aria-label":"add 1 card",type:"button",onClick:()=>p(a.card_id),className:"flex h-8 w-8 items-center justify-center rounded-full bg-green-500 text-white transition duration-200 hover:bg-green-400 focus:outline-none",children:e.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{d:"M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z"})})})]})]})}const x=k();function C({cards:a}){const r=l.useRef(null),[m,d]=l.useState(()=>{const t=localStorage.getItem("scrollPosition");return t?Number.parseInt(t,10):0}),h=l.useMemo(()=>[x.accessor("image",{id:"imageUrl"}),x.accessor("card_id",{id:"card_id"}),x.accessor("name",{id:"name"}),x.accessor("set_details",{id:"set_details"})],[]),g=D({columns:h,data:a,enableGrouping:!0,getCoreRowModel:z(),getGroupedRowModel:P(),initialState:{grouping:["set_details"]}}),c=l.useMemo(()=>g.getGroupedRowModel().rows,[g.getGroupedRowModel().rows]),p=l.useMemo(()=>c.map(t=>{const o={type:"header",row:t},s=t.subRows.map(u=>({type:"data",row:u})),i=[];for(let u=0;u<s.length;u+=5)i.push(s.slice(u,u+5));return{header:o,gridRows:i}}),[c]),f=l.useMemo(()=>p.flatMap(t=>[{type:"header",height:45,data:t.header},...t.gridRows.map(o=>({type:"gridRow",height:269,data:o}))]),[p]),n=I({getScrollElement:()=>r.current,count:f.length,estimateSize:t=>(f[t].type==="header"?45:269)+12,overscan:5});return l.useEffect(()=>{const t=()=>{if(r.current){const s=r.current.scrollTop;d(s),localStorage.setItem("scrollPosition",s.toString())}},o=r.current;return o&&o.addEventListener("scroll",t),()=>{o&&o.removeEventListener("scroll",t)}},[]),l.useEffect(()=>{r.current&&(r.current.scrollTop=m)},[m]),e.jsx("div",{ref:r,className:"h-[calc(100vh-180px)] overflow-y-auto",children:e.jsx("div",{style:{height:`${n.getTotalSize()}px`},className:"relative w-full",children:n.getVirtualItems().map(t=>{const o=f[t.index];return e.jsx("div",{style:{height:`${t.size}px`,transform:`translateY(${t.start}px)`},className:"absolute top-0 left-0 w-full",children:o.type==="header"?e.jsx("h2",{className:"mt-10 w-full scroll-m-20 border-b pb-2 font-semibold text-3xl tracking-tight transition-colors first:mt-0",children:o.data.row.getValue("set_details")}):e.jsx("div",{className:"flex justify-center gap-5",children:o.data.map(({row:s})=>e.jsx(G,{card:s.original},s.original.card_id))})},t.key)})})})}function B(){return e.jsx("div",{className:"mx-auto flex max-w-[900px] flex-col gap-y-4",children:e.jsxs(T,{defaultValue:"all",children:[e.jsxs(S,{className:"m-auto mt-4 mb-8",children:[e.jsx(_,{value:"all",children:"All"}),v.map(a=>e.jsx(_,{value:a.id,children:a.name},`tab_trigger_${a.id}`))]}),e.jsx(j,{value:"all",children:e.jsx(C,{cards:E})}),v.map(a=>e.jsx(j,{value:a.id,children:e.jsx(C,{cards:a.cards},`tab_content_${a.id}`)},`tab_content_${a.id}`))]})})}export{B as default};
