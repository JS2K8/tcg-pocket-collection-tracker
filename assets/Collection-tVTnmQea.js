import{e as F,j as e,I as S,r as n,U as D,C as M,f as L,D as y,h as v,i as k,L as V,B as N,M as E}from"./index-BGOccV7I.js";import{T as R,a as T,b as C}from"./tabs-C6Ju5Cml.js";import{e as I,b as O}from"./CardsDB-9ENfkm57.js";import{R as $}from"./RarityFilter-BU5JpBKf.js";import{u as z}from"./useWindowDimensionsHook-C1bPAdpT.js";import{c as G,u as B,a as H,g as P,b as U}from"./index-CC2RxLHQ.js";import{F as A}from"./FancyCard-vipzMOaz.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],q=F("Plus",W),Y=({expansionFilter:s,setExpansionFilter:r})=>e.jsx(R,{value:s,onValueChange:l=>r(l),className:"w-full",children:e.jsxs(T,{className:"w-full flex-wrap h-auto lg:h-[40px] border-2 border-slate-600 rounded-md",children:[e.jsx(C,{value:"all",children:"All"}),I.map(l=>e.jsx(C,{value:l.id,children:l.name},`tab_trigger_${l.id}`))]})}),J=({ownedFilter:s,setOwnedFilter:r})=>e.jsx(R,{value:s,onValueChange:l=>r(l),className:"w-50",children:e.jsxs(T,{className:"w-full flex-wrap h-auto lg:h-10 bg-neutral-50 border-2 border-slate-600 rounded-md",children:[e.jsx(C,{value:"all",children:"All"}),e.jsx(C,{value:"missing",children:"Missing"}),e.jsx(C,{value:"owned",children:"Owned"})]})});let j=null;const K=({setSearchValue:s})=>e.jsx(S,{type:"search",placeholder:"Search...",className:"w-full md:w-64 border-2 h-[38px]",style:{borderColor:"#45556C"},onChange:r=>{j&&window.clearTimeout(j),j=window.setTimeout(()=>{s(r.target.value)},500)}}),b={};function Q({card:s}){const{user:r,setIsLoginDialogOpen:l}=n.use(D),{ownedCards:c,setOwnedCards:p}=n.use(M);let o=n.useMemo(()=>{var a;return((a=c.find(d=>d.card_id===s.card_id))==null?void 0:a.amount_owned)||0},[c]);const[w,u]=n.useState(0);n.useEffect(()=>{u(o)},[o]);const x=n.useCallback(async(a,d)=>{o=Math.max(0,d),u(o),b[a]&&window.clearTimeout(b[a]),b[a]=window.setTimeout(async()=>{const g=await L(),m=c.find(f=>f.card_id===a);if(m)console.log("updating",m),m.amount_owned=Math.max(0,d),p([...c]),await g.updateDocument(y,v,m.$id,{amount_owned:m.amount_owned});else if(!m&&d>0){console.log("adding new card",a);const f=await g.createDocument(y,v,k.unique(),{email:r==null?void 0:r.email,card_id:a,amount_owned:d});p([...c,{$id:f.$id,email:f.email,card_id:f.card_id,amount_owned:f.amount_owned}])}},1e3)},[c,r,p,o]),h=n.useCallback(async a=>{if(!r){l(!0);return}await x(a,o+1)},[x]),i=n.useCallback(async a=>{if(!r){l(!0);return}await x(a,o-1)},[x]),t=async a=>{const d=a.target.value===""?0:Number.parseInt(a.target.value,10);!Number.isNaN(d)&&d>=0&&await x(s.card_id,d)};return e.jsxs("div",{className:"group flex w-fit max-w-40 flex-col items-center rounded-lg",children:[e.jsx(V,{viewTransition:!0,to:`/card/${s.card_id}`,state:{card:s},children:e.jsx(A,{card:s,selected:o>0})}),e.jsxs("p",{className:"max-w-[130px] overflow-hidden text-ellipsis whitespace-nowrap font-semibold text-[12px] pt-2",children:[s.card_id," - ",s.name]}),e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsx(N,{variant:"ghost",size:"icon",onClick:()=>i(s.card_id),className:"rounded-full",children:e.jsx(E,{})}),e.jsx("input",{min:"0",max:"99",type:"text",value:w,onChange:t,className:"w-7 text-center border-none rounded",onFocus:a=>a.target.select()}),e.jsx(N,{variant:"ghost",size:"icon",className:"rounded-full",onClick:()=>h(s.card_id),children:e.jsx(q,{})})]})]})}const _=G();function X({cards:s}){const r=n.useRef(null),{width:l}=z(),c=n.useMemo(()=>[_.accessor("image",{id:"imageUrl"}),_.accessor("card_id",{id:"card_id"}),_.accessor("name",{id:"name"}),_.accessor("set_details",{id:"set_details"})],[]),p=B({columns:c,data:s,enableGrouping:!0,getCoreRowModel:U(),getGroupedRowModel:P(),initialState:{grouping:["set_details"]}}),o=n.useMemo(()=>p.getGroupedRowModel().rows,[p.getGroupedRowModel().rows]);let w=5,u=Math.min(l,890)/5+120;l>600&&l<800?(w=4,u=l/3+50):l<=600&&(w=3,u=l/3+100);const x=n.useMemo(()=>o.map(t=>{const a={type:"header",row:t},d=t.subRows.map(m=>({type:"data",row:m})),g=[];for(let m=0;m<d.length;m+=w)g.push(d.slice(m,m+w));return{header:a,gridRows:g}}),[o,w]),h=n.useMemo(()=>x.flatMap(t=>[{type:"header",height:60,data:t.header},...t.gridRows.map(a=>({type:"gridRow",height:u,data:a}))]),[x]),i=H({getScrollElement:()=>r.current,count:h.length,estimateSize:t=>(h[t].type==="header"?60:u)+12,overscan:5});return e.jsx("div",{ref:r,className:"h-[calc(100vh-270px)] overflow-y-auto mt-4 sm:mt-8 px-4",style:{scrollbarWidth:"none"},children:e.jsx("div",{style:{height:`${i.getTotalSize()}px`},className:"relative w-full",children:i.getVirtualItems().map(t=>{const a=h[t.index];return e.jsx("div",{style:{height:`${t.size}px`,transform:`translateY(${t.start}px)`},className:"absolute top-0 left-0 w-full",children:a.type==="header"?e.jsx("h2",{className:"mx-auto mt-10 text-center w-full max-w-[900px] scroll-m-20 border-b-2 border-slate-600 pb-2 font-semibold text-3xl tracking-tight transition-colors first:mt-0",children:a.data.row.getValue("set_details")}):e.jsx("div",{className:"flex justify-center gap-x-3",children:a.data.map(({row:d})=>e.jsx(Q,{card:d.original},d.original.card_id))})},t.key)})})})}function ne(){const{ownedCards:s}=n.use(M),[r,l]=n.useState(""),[c,p]=n.useState("all"),[o,w]=n.useState([]),[u,x]=n.useState("all"),h=n.useMemo(()=>{let i=O;return c!=="all"&&(i=i.filter(t=>t.expansion===c)),u!=="all"&&(u==="owned"?i=i.filter(t=>s.find(a=>a.card_id===t.card_id&&a.amount_owned>0)):u==="missing"&&(i=i.filter(t=>!s.find(a=>a.card_id===t.card_id&&a.amount_owned>0)))),o.length>0&&(i=i.filter(t=>o.includes(t.rarity))),r&&(i=i.filter(t=>t.name.toLowerCase().includes(r.toLowerCase())||t.card_id.toLowerCase().includes(r.toLowerCase()))),i},[c,o,r,u,s]);return e.jsxs("div",{className:"flex flex-col gap-y-1 mx-auto max-w-[900px]",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-col md:flex-row px-8",children:[e.jsx(K,{setSearchValue:l}),e.jsx(Y,{expansionFilter:c,setExpansionFilter:p})]}),e.jsxs("div",{className:"items-center justify-between gap-2 flex-col md:flex-row px-8 hidden md:flex",children:[e.jsx(J,{ownedFilter:u,setOwnedFilter:x}),e.jsx($,{rarityFilter:o,setRarityFilter:w})]}),e.jsx(X,{cards:h})]})}export{ne as default};
