import{e as T,r as s,U as k,C as z,f as $,D as C,h as j,I as E,j as e,B as v,M as I}from"./index-Btv3aH_U.js";import{T as L,a as S,b as y,c as N}from"./tabs-COAsxJbr.js";import{e as M,b as V}from"./CardsDB-CePrsvJ-.js";import{F as G,c as O,u as W,a as A,g as P,b as B}from"./FancyCard-Dw-TRNFZ.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],H=T("Plus",F);function R(){const{innerWidth:t,innerHeight:i}=window;return{width:t,height:i}}function U(){const[t,i]=s.useState(R());return s.useEffect(()=>{function d(){i(R())}return window.addEventListener("resize",d),()=>window.removeEventListener("resize",d)},[]),t}let b=null;function q({card:t}){const{user:i,setIsLoginDialogOpen:d}=s.use(k),{ownedCards:r,setOwnedCards:g}=s.use(z),l=s.useMemo(()=>{var a;return((a=r.find(o=>o.card_id===t.card_id))==null?void 0:a.amount_owned)||0},[r]),[f,h]=s.useState(0);s.useEffect(()=>{h(l)},[l]);const c=s.useCallback(async(a,o)=>{console.log(`${a} button clicked`);const m=await $(),w=r.find(p=>p.card_id===a);if(w)console.log("updating",w),w.amount_owned=Math.max(0,w.amount_owned+o),g([...r]),await m.updateDocument(C,j,w.$id,{amount_owned:w.amount_owned});else if(!w&&o>0){console.log("adding new card",a);const p=await m.createDocument(C,j,E.unique(),{email:i==null?void 0:i.email,card_id:a,amount_owned:o});g([...r,{$id:p.$id,email:p.email,card_id:p.card_id,amount_owned:p.amount_owned}])}h(Math.max(0,l+o))},[r,i,g,l]),x=s.useCallback(async a=>{if(!i){d(!0);return}await c(a,1)},[c]),n=s.useCallback(async a=>{if(!i){d(!0);return}l>0&&await c(a,-1)},[c,l]),u=a=>{const o=a.target.value===""?0:Number.parseInt(a.target.value,10);!Number.isNaN(o)&&o>=0&&(h(o),b&&window.clearTimeout(b),b=window.setTimeout(async()=>{await c(t.card_id,o-l)},300))};return e.jsxs("div",{className:"group flex w-fit flex-col items-center rounded-lg",children:[e.jsx(G,{card:t,selected:l>0}),e.jsxs("p",{className:"max-w-[130px] overflow-hidden text-ellipsis whitespace-nowrap font-semibold text-[12px] pt-2",children:[t.card_id," - ",t.name]}),e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsx(v,{variant:"ghost",size:"icon",onClick:()=>n(t.card_id),className:"rounded-full",children:e.jsx(I,{})}),e.jsx("input",{min:"0",max:"99",type:"text",value:f,onChange:u,className:"w-7 text-center border-none rounded",onFocus:a=>a.target.select()}),e.jsx(v,{variant:"ghost",size:"icon",className:"rounded-full",onClick:()=>x(t.card_id),children:e.jsx(H,{})})]})]})}const _=O();function D({cards:t}){const i=s.useRef(null),{width:d}=U();let r=5;d>800&&d<1e3?r=4:d<=800&&(r=3);const g=s.useMemo(()=>[_.accessor("image",{id:"imageUrl"}),_.accessor("card_id",{id:"card_id"}),_.accessor("name",{id:"name"}),_.accessor("set_details",{id:"set_details"})],[]),l=W({columns:g,data:t,enableGrouping:!0,getCoreRowModel:B(),getGroupedRowModel:P(),initialState:{grouping:["set_details"]}}),f=s.useMemo(()=>l.getGroupedRowModel().rows,[l.getGroupedRowModel().rows]),h=s.useMemo(()=>f.map(n=>{const u={type:"header",row:n},a=n.subRows.map(m=>({type:"data",row:m})),o=[];for(let m=0;m<a.length;m+=r)o.push(a.slice(m,m+r));return{header:u,gridRows:o}}),[f,r]),c=s.useMemo(()=>h.flatMap(n=>[{type:"header",height:60,data:n.header},...n.gridRows.map(u=>({type:"gridRow",height:250,data:u}))]),[h]),x=A({getScrollElement:()=>i.current,count:c.length,estimateSize:n=>(c[n].type==="header"?60:250)+12,overscan:5});return e.jsx("div",{ref:i,className:"h-[calc(100vh-180px)] overflow-y-auto",style:{scrollbarWidth:"none"},children:e.jsx("div",{style:{height:`${x.getTotalSize()}px`},className:"relative w-full",children:x.getVirtualItems().map(n=>{const u=c[n.index];return e.jsx("div",{style:{height:`${n.size}px`,transform:`translateY(${n.start}px)`},className:"absolute top-0 left-0 w-full",children:u.type==="header"?e.jsx("h2",{className:"mt-10 text-center w-full scroll-m-20 border-b border-gray-200 pb-2 font-semibold text-3xl tracking-tight transition-colors first:mt-0",children:u.data.row.getValue("set_details")}):e.jsx("div",{className:"flex justify-center gap-x-5",children:u.data.map(({row:a})=>e.jsx(q,{card:a.original},a.original.card_id))})},n.key)})})})}function X(){return e.jsx("div",{className:"mx-auto flex max-w-[900px] flex-col gap-y-4",children:e.jsxs(L,{defaultValue:"all",children:[e.jsxs(S,{className:"w-full m-auto mt-4 mb-8",children:[e.jsx(y,{value:"all",children:"All"}),M.map(t=>e.jsx(y,{value:t.id,children:t.name},`tab_trigger_${t.id}`))]}),e.jsx(N,{value:"all",children:e.jsx(D,{cards:V})}),M.map(t=>e.jsx(N,{value:t.id,children:e.jsx(D,{cards:t.cards},`tab_content_${t.id}`)},`tab_content_${t.id}`))]})})}export{X as default};
