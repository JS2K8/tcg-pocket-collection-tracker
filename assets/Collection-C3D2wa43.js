import{r as o,U as T,C as R,e as S,D as _,f as j,I as E,j as e}from"./index-BntTkVKb.js";import{T as D,a as I,b as C,c as y}from"./tabs-BpbLaByc.js";import{e as N,b as $}from"./CardsDB-CePrsvJ-.js";import{F as k,c as P,u as V,a as z,g as G,b as L}from"./FancyCard-D0QysfzO.js";let v=null;function A({card:s}){const{user:r,setIsLoginDialogOpen:p}=o.use(T),{ownedCards:u,setOwnedCards:f}=o.use(R),i=o.useMemo(()=>{var t;return((t=u.find(l=>l.card_id===s.card_id))==null?void 0:t.amount_owned)||0},[u]),[w,h]=o.useState(0);o.useEffect(()=>{h(i)},[i]);const d=o.useCallback(async(t,l)=>{console.log(`${t} button clicked`);const c=await S(),m=u.find(g=>g.card_id===t);if(m)console.log("updating",m),m.amount_owned=Math.max(0,m.amount_owned+l),f([...u]),await c.updateDocument(_,j,m.$id,{amount_owned:m.amount_owned});else if(!m&&l>0){console.log("adding new card",t);const g=await c.createDocument(_,j,E.unique(),{email:r==null?void 0:r.email,card_id:t,amount_owned:l});f([...u,{$id:g.$id,email:g.email,card_id:g.card_id,amount_owned:g.amount_owned}])}h(Math.max(0,i+l))},[u,r,f,i]),x=o.useCallback(async t=>{if(!r){p(!0);return}await d(t,1)},[d]),a=o.useCallback(async t=>{if(!r){p(!0);return}i>0&&await d(t,-1)},[d,i]),n=t=>{const l=t.target.value===""?0:Number.parseInt(t.target.value,10);!Number.isNaN(l)&&l>=0&&(h(l),v&&window.clearTimeout(v),v=window.setTimeout(async()=>{await d(s.card_id,l-i)},300))};return e.jsxs("div",{className:"group flex w-fit flex-col items-center gap-y-2 rounded-lg border border-gray-700 p-4 shadow-md transition duration-200 hover:shadow-lg",children:[e.jsx(k,{card:s,selected:i>0}),e.jsxs("p",{className:"max-w-[130px] overflow-hidden text-ellipsis whitespace-nowrap font-semibold text-[12px]",children:[s.card_id," - ",s.name]}),e.jsxs("div",{className:"flex items-center gap-x-4",children:[e.jsx("button",{name:"remove","aria-label":"remove 1 card",type:"button",onClick:()=>a(s.card_id),className:"flex h-8 w-8 items-center justify-center rounded-full bg-red-500 text-white transition duration-200 hover:bg-red-400 focus:outline-none",children:e.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{d:"M5 10a.75.75 0 0 1 .75-.75h8.5a.75.75 0 0 1 0 1.5h-8.5A.75.75 0 0 1 5 10z"})})}),e.jsx("input",{type:"text",value:w,onChange:n,className:"w-7 text-center border border-gray-300 rounded"}),e.jsx("button",{name:"add","aria-label":"add 1 card",type:"button",onClick:()=>x(s.card_id),className:"flex h-8 w-8 items-center justify-center rounded-full bg-green-500 text-white transition duration-200 hover:bg-green-400 focus:outline-none",children:e.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{d:"M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z"})})})]})]})}const b=P();function M({cards:s}){const r=o.useRef(null),[p,u]=o.useState(()=>{const a=localStorage.getItem("scrollPosition");return a?Number.parseInt(a,10):0}),f=o.useMemo(()=>[b.accessor("image",{id:"imageUrl"}),b.accessor("card_id",{id:"card_id"}),b.accessor("name",{id:"name"}),b.accessor("set_details",{id:"set_details"})],[]),i=V({columns:f,data:s,enableGrouping:!0,getCoreRowModel:L(),getGroupedRowModel:G(),initialState:{grouping:["set_details"]}}),w=o.useMemo(()=>i.getGroupedRowModel().rows,[i.getGroupedRowModel().rows]),h=o.useMemo(()=>w.map(a=>{const n={type:"header",row:a},t=a.subRows.map(c=>({type:"data",row:c})),l=[];for(let c=0;c<t.length;c+=5)l.push(t.slice(c,c+5));return{header:n,gridRows:l}}),[w]),d=o.useMemo(()=>h.flatMap(a=>[{type:"header",height:45,data:a.header},...a.gridRows.map(n=>({type:"gridRow",height:269,data:n}))]),[h]),x=z({getScrollElement:()=>r.current,count:d.length,estimateSize:a=>(d[a].type==="header"?45:269)+12,overscan:5});return o.useEffect(()=>{const a=()=>{if(r.current){const t=r.current.scrollTop;u(t),localStorage.setItem("scrollPosition",t.toString())}},n=r.current;return n&&n.addEventListener("scroll",a),()=>{n&&n.removeEventListener("scroll",a)}},[]),o.useEffect(()=>{r.current&&(r.current.scrollTop=p)},[p]),e.jsx("div",{ref:r,className:"h-[calc(100vh-180px)] overflow-y-auto",children:e.jsx("div",{style:{height:`${x.getTotalSize()}px`},className:"relative w-full",children:x.getVirtualItems().map(a=>{const n=d[a.index];return e.jsx("div",{style:{height:`${a.size}px`,transform:`translateY(${a.start}px)`},className:"absolute top-0 left-0 w-full",children:n.type==="header"?e.jsx("h2",{className:"mt-10 w-full scroll-m-20 border-b pb-2 font-semibold text-3xl tracking-tight transition-colors first:mt-0",children:n.data.row.getValue("set_details")}):e.jsx("div",{className:"flex justify-center gap-5",children:n.data.map(({row:t})=>e.jsx(A,{card:t.original},t.original.card_id))})},a.key)})})})}function H(){return e.jsx("div",{className:"mx-auto flex max-w-[900px] flex-col gap-y-4",children:e.jsxs(D,{defaultValue:"all",children:[e.jsxs(I,{className:"m-auto mt-4 mb-8",children:[e.jsx(C,{value:"all",children:"All"}),N.map(s=>e.jsx(C,{value:s.id,children:s.name},`tab_trigger_${s.id}`))]}),e.jsx(y,{value:"all",children:e.jsx(M,{cards:$})}),N.map(s=>e.jsx(y,{value:s.id,children:e.jsx(M,{cards:s.cards},`tab_content_${s.id}`)},`tab_content_${s.id}`))]})})}export{H as default};
