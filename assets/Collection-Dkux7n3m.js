import{e as T,r as n,U as k,C as D,f as $,D as j,h as C,I as z,j as e,L,B as v,M as V}from"./index-DMG5nXZl.js";import{T as E,a as G,b as y,c as N}from"./tabs-BEm7n0so.js";import{e as M,b as I}from"./CardsDB-rgf4w0hI.js";import{F as S,u as O,c as P,a as B,b as F,g as U,d as H}from"./FancyCard-B1FT6tD0.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],q=T("Plus",W),b={};function A({card:t}){const{user:r,setIsLoginDialogOpen:x}=n.use(k),{ownedCards:u,setOwnedCards:p}=n.use(D);let l=n.useMemo(()=>{var a;return((a=u.find(o=>o.card_id===t.card_id))==null?void 0:a.amount_owned)||0},[u]);const[m,g]=n.useState(0);n.useEffect(()=>{g(l)},[l]);const i=n.useCallback(async(a,o)=>{l=Math.max(0,o),g(l),b[a]&&window.clearTimeout(b[a]),b[a]=window.setTimeout(async()=>{const c=await $(),h=u.find(w=>w.card_id===a);if(h)console.log("updating",h),h.amount_owned=Math.max(0,o),p([...u]),await c.updateDocument(j,C,h.$id,{amount_owned:h.amount_owned});else if(!h&&o>0){console.log("adding new card",a);const w=await c.createDocument(j,C,z.unique(),{email:r==null?void 0:r.email,card_id:a,amount_owned:o});p([...u,{$id:w.$id,email:w.email,card_id:w.card_id,amount_owned:w.amount_owned}])}},1e3)},[u,r,p,l]),f=n.useCallback(async a=>{if(!r){x(!0);return}await i(a,l+1)},[i]),s=n.useCallback(async a=>{if(!r){x(!0);return}await i(a,l-1)},[i]),d=async a=>{const o=a.target.value===""?0:Number.parseInt(a.target.value,10);!Number.isNaN(o)&&o>=0&&await i(t.card_id,o)};return e.jsxs("div",{className:"group flex w-fit flex-col items-center rounded-lg",children:[e.jsx(L,{viewTransition:!0,to:`/card/${t.card_id}`,state:{card:t},children:e.jsx(S,{card:t,selected:l>0})}),e.jsxs("p",{className:"max-w-[130px] overflow-hidden text-ellipsis whitespace-nowrap font-semibold text-[12px] pt-2",children:[t.card_id," - ",t.name]}),e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsx(v,{variant:"ghost",size:"icon",onClick:()=>s(t.card_id),className:"rounded-full",children:e.jsx(V,{})}),e.jsx("input",{min:"0",max:"99",type:"text",value:m,onChange:d,className:"w-7 text-center border-none rounded",onFocus:a=>a.target.select()}),e.jsx(v,{variant:"ghost",size:"icon",className:"rounded-full",onClick:()=>f(t.card_id),children:e.jsx(q,{})})]})]})}const _=P();function R({cards:t}){const r=n.useRef(null),{width:x}=O(),u=n.useMemo(()=>[_.accessor("image",{id:"imageUrl"}),_.accessor("card_id",{id:"card_id"}),_.accessor("name",{id:"name"}),_.accessor("set_details",{id:"set_details"})],[]),p=B({columns:u,data:t,enableGrouping:!0,getCoreRowModel:H(),getGroupedRowModel:U(),initialState:{grouping:["set_details"]}}),l=n.useMemo(()=>p.getGroupedRowModel().rows,[p.getGroupedRowModel().rows]);let m=5;x>800&&x<1e3?m=4:x<=800&&(m=3);const g=n.useMemo(()=>l.map(s=>{const d={type:"header",row:s},a=s.subRows.map(c=>({type:"data",row:c})),o=[];for(let c=0;c<a.length;c+=m)o.push(a.slice(c,c+m));return{header:d,gridRows:o}}),[l,m]),i=n.useMemo(()=>g.flatMap(s=>[{type:"header",height:60,data:s.header},...s.gridRows.map(d=>({type:"gridRow",height:250,data:d}))]),[g]),f=F({getScrollElement:()=>r.current,count:i.length,estimateSize:s=>(i[s].type==="header"?60:250)+12,overscan:5});return e.jsx("div",{ref:r,className:"h-[calc(100vh-180px)] overflow-y-auto",style:{scrollbarWidth:"none"},children:e.jsx("div",{style:{height:`${f.getTotalSize()}px`},className:"relative w-full",children:f.getVirtualItems().map(s=>{const d=i[s.index];return e.jsx("div",{style:{height:`${s.size}px`,transform:`translateY(${s.start}px)`},className:"absolute top-0 left-0 w-full",children:d.type==="header"?e.jsx("h2",{className:"mx-auto mt-10 text-center w-full max-w-[900px] scroll-m-20 border-b border-gray-200 pb-2 font-semibold text-3xl tracking-tight transition-colors first:mt-0",children:d.data.row.getValue("set_details")}):e.jsx("div",{className:"flex justify-center gap-x-3",children:d.data.map(({row:a})=>e.jsx(A,{card:a.original},a.original.card_id))})},s.key)})})})}function X(){return e.jsx("div",{className:"flex flex-col gap-y-4",children:e.jsxs(E,{defaultValue:"all",children:[e.jsx("div",{className:"mx-auto max-w-[900px]",children:e.jsxs(G,{className:"w-full m-auto mt-4 mb-8 flex-wrap h-auto",children:[e.jsx(y,{value:"all",children:"All"}),M.map(t=>e.jsx(y,{value:t.id,children:t.name},`tab_trigger_${t.id}`))]})}),e.jsxs("div",{className:"mx-auto max-w-auto",children:[e.jsx(N,{value:"all",children:e.jsx(R,{cards:I})}),M.map(t=>e.jsx(N,{value:t.id,children:e.jsx(R,{cards:t.cards},`tab_content_${t.id}`)},`tab_content_${t.id}`))]})]})})}export{X as default};
